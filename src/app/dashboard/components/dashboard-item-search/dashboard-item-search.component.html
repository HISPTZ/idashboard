<div class="form-group" style="position: relative;" appClickOutside (clickOutside)="showBody = false">
  <div class="form-group has-feedback dashboard-search-block">
    <input
      type="text"
      id="search"
      [(ngModel)]="searchText"
      (ngModelChange)="search(searchText)"
      [ngClass]="['form-control', 'dashboard-search']"
      (focus)="updateSearchBody()"
      placeholder="Add charts, tables, maps,etc. by searching them here"
    >
    <span *ngIf="!(dashboardSearchItems$ | async).loading" class="form-control-feedback search-icon">
      <img [src]="'assets/img/search.png'" alt="">
    </span>
    <span *ngIf="(dashboardSearchItems$ | async).loading" class="form-control-feedback">
      <img src="assets/img/balls-3.svg" style="height: 30px; width: 30px;" alt="">
    </span>
  </div>
  <div class="panel search-panel" *ngIf="showBody">
    <div class="panel-heading search-panel-heading">
      <ul class="nav nav-pills search-header-nav">
        <li
          *ngFor="let header of (dashboardSearchItems$ | async).headers"
          [ngClass]="header.selected ? 'active-search-header' : ''"
        >
          <a
             tooltip="{{header.title}}"
             placement="bottom"
             style="position: relative"
             (click)="toggleHeaderSelection(header, $event)"
          >
            <span *ngIf="!header.icon">{{header.name}}</span>
            <img *ngIf="header.icon" [src]="header.icon" alt="" [ngClass]="'search-header-icon'">
            <span
              *ngIf="header.itemCount > 0 && header.name !== 'all'"
              class="badge search-header-icon-badge bg-success">{{header.itemCount | kNumber}}</span>
          </a>
        </li>
      </ul>
      <div><small>About {{(dashboardSearchItems$ | async).resultCount}} result{{(dashboardSearchItems$ | async).resultCount > 1 ? 's': ''}} found</small></div>
    </div>
    <div class="panel-body search-panel-body">
      <div class="text-center" *ngIf="(dashboardSearchItems$ | async).results.length === 0">
        <div style="margin: 40px;" *ngIf="(dashboardSearchItems$ | async).loaded">
          <img [src]="'assets/img/empty-flag.png'" alt="">
          <h3 class="text-muted">No search results found for "{{searchText}}"</h3>
        </div>
      </div>

      <div class="row" *ngIf="(dashboardSearchItems$ | async).loading">
        <div class="col-md-12 text-center">
          <img src="assets/img/balls-3.svg" alt="">
          <h5 style="margin-top: 20px;">
            Searching...
          </h5>
        </div>
      </div>
      <table
        width="100%"
        class="table table-hover search-table"
        *ngIf="(dashboardSearchItems$ | async).results.length > 0 && !(dashboardSearchItems$ | async).loading">
        <tr
          *ngFor="let result of (dashboardSearchItems$ | async).results | filterBy: searchItemName"
          [hidden]="!result.selected"
        >
          <td width="4%">
            <img [src]="result.icon" [ngClass]="'result-header-icons'" alt="">
          </td>
          <td width="90%">
            <a class="header-link"><small>{{result.name}}</small></a>
          </td>
          <td width="6%">
            <button
              class="btn btn-default btn-xs pull-right result-header-btn"
              (click)="addDashboardItem({
              dashboardId: currentDashboard,
              type: dashboardItemTypes[result.type],
              id: result.type == 'apps' ? result.key : result.id})"
            >ADD</button>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

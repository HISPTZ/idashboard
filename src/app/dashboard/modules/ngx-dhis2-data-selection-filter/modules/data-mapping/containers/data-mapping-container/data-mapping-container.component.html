<div class="data-filter-container">
  <div class="data-filter-content">
    <div class="data-filter-group-selection" appClickOutside (clickOutside)="showGroups = false">
      <!--Group selection button-->
      <button class="btn btn-outline-secondary btn-sm data-filter-group-btn" (click)="toggleDataFilterGroupList($event)">
        <span>{{ selectedGroup?.name || 'Select'}}</span>
        <span>
          <img src="assets/icons/arrow-down.png" alt="">
        </span>
      </button>
      <!-- end of Group selection button -->

      <!-- data grouping button -->
      <button class="data-filter-grouping-btn" [title]="'Open grouping panel'" (click)="onToggleGroupingPanel($event)">
        <img [src]="listIcon" alt="">&nbsp;
        <img [src]="showGroupingPanel ? arrowLeftIcon : arrowRightIcon" alt="">
      </button>
      <!-- end of data grouping button -->

      <!--Group selection list-->
      <div class="data-filter-group-panel" *ngIf="showGroups">
        <div class="panel-body data-filter-group-panel-body">
          <input type="search" class="form-control form-control-sm" placeholder="Search" [(ngModel)]="querystring">
          <ul class="data-filter-group-list">
            <li *ngFor="let item of dataGroups | filterByName: querystring">
              <a (click)="setSelectedGroup(item, scrollse, $event)">{{ item.name }}</a>
            </li>
          </ul>
        </div>
      </div>
      <!--end of Group selection list-->
    </div>

    <div class="data-filter-list-search">
      <input type="text" class="form-control form-control-sm" (focus)="showBody = true" (keyup)="searchChanged()" placeholder="Search"
        [(ngModel)]="listchanges">
    </div>
    <div class="data-filter-available-header">
      <span>Available ({{(dataElements | filterByName:listchanges).length}})</span>
      <a (click)="selectAllItems($event)">&raquo;</a>
    </div>
    <div class="data-filter-selected-header">
      <a (click)="deselectAllItems($event)">&laquo;</a>
      <span>Selected ({{(selectedItems$ | async).length }})</span>
    </div>

    <div class="data-filter-available-body">
      <ul #scrollse>
        <li *ngIf="(dataElements | filterByName:listchanges).length == 0">
          <a>No items</a>
        </li>
        <li *ngFor="let item of dataElements | filterByName:listchanges |  paginate: { id: 'foo',itemsPerPage: 25, currentPage: availablePagenator }"
          [ngClass]="{'hiddenTree': inSelected(item, selectedItems)}" title="Click to select item" id="{{item.id | addUnderscore}}">
          <a (click)="addSelected(item, $event)">{{ item.name }}</a>
        </li>

        <li *ngIf="(dataElements | filterByName:listchanges).length >= 25">
          <a>
            <pagination-controls id="foo" (pageChange)="availablePagenator = $event" maxSize="0">
            </pagination-controls>
          </a>
        </li>
      </ul>
    </div>

    <div class="data-filter-selected-body">
      <ul>
        <li *ngFor="let item of selectedItems$ | async | paginate:{id: 'selectedlist',itemsPerPage: 100, currentPage:selectedPagenator }"
          style="cursor: move" dnd-droppable (onDropSuccess)="transferDataSuccess($event,item)" title="click to unselect item">
          <a dnd-draggable [dragEnabled]="true" (click)="removeSelected(item, $event)" [dragData]="item" class="{{item.hasOwnProperty('programType') ? 'auto-growing' : ''}}">
            {{ item.name }} </a>
        </li>
        <li *ngIf="(selectedItems$ | async).length > 100">
          <pagination-controls id='selectedlist' maxSize="0" (pageChange)="selectedPagenator = $event"></pagination-controls>
        </li>
      </ul>
    </div>
  </div>
  <!-- data filter groups -->
  <div class="data-filter-groups-container" *ngIf="showGroupingPanel">
    <app-data-mapping-groups [groupMemberTitle]="mappingGroupTitle" [groupTitle]="mappingTitle" [groupDescription]="mappingDescription"
      [dataGroups]="mappingGroups"></app-data-mapping-groups>
  </div>
  <!-- end of data filter groups -->
</div>

<div class="data-filter-btns">
  <div>
    <button class="btn btn-outline-secondary btn-sm" (click)="close($event)">Close</button>
    <button class="btn btn-outline-secondary btn-sm" [disabled]="(selectedItems$ | async).length === 0" (click)="emit($event)">Update</button>
  </div>
</div>

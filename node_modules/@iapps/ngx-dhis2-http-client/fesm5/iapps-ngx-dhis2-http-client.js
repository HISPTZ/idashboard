import { Injectable, defineInjectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { of, forkJoin, Observable, throwError } from 'rxjs';
import { tap, catchError, map, switchMap, mergeMap as mergeMap$1 } from 'rxjs/internal/operators';
import { __assign, __spread } from 'tslib';
import { isArray, each } from 'lodash';
import { switchMap as switchMap$1, mergeMap } from 'rxjs/operators';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var ManifestService = /** @class */ (function () {
    function ManifestService(httpClient) {
        this.httpClient = httpClient;
        this._defaultRootUrl = '../../../';
        this._manifestLoaded = false;
    }
    /**
     * @return {?}
     */
    ManifestService.prototype.getManifest = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return this._manifestLoaded ? of(this._manifest) : this.httpClient.get('manifest.webapp').pipe(catchError(function () {
            console.warn('Manifest file could not be loaded, default options have been used instead');
            return of(null);
        }), tap(function (manifest) {
            _this._manifest = manifest;
            _this._manifestLoaded = true;
        }));
    };
    /**
     * @return {?}
     */
    ManifestService.prototype.getRootUrl = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return this.getManifest().pipe(map(function (manifest) {
            if (!manifest) {
                return _this._defaultRootUrl;
            }
            return manifest.activities && manifest.activities.dhis && manifest.activities.dhis.href ?
                manifest.activities.dhis.href : _this._defaultRootUrl;
        }));
    };
    ManifestService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    ManifestService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ ManifestService.ngInjectableDef = defineInjectable({ factory: function ManifestService_Factory() { return new ManifestService(inject(HttpClient)); }, token: ManifestService, providedIn: "root" });
    return ManifestService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var SystemInfoService = /** @class */ (function () {
    function SystemInfoService(manifestService, httpClient) {
        this.manifestService = manifestService;
        this.httpClient = httpClient;
        this._systemInfoLoaded = false;
    }
    /**
     * @return {?}
     */
    SystemInfoService.prototype.getSystemInfo = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return this._systemInfoLoaded ? of(this._systemInfo) :
            this.manifestService.getRootUrl().pipe(switchMap(function (rootUrl) { return forkJoin(_this.httpClient.get(rootUrl + "api/system/info"), _this.httpClient.get(rootUrl + "api/systemSettings")).pipe(map(function (res) {
                return __assign({}, res[0], res[1]);
            }), tap(function (systemInfo) {
                _this._systemInfo = systemInfo;
                _this._systemInfoLoaded = true;
            })); }));
    };
    /**
     * @return {?}
     */
    SystemInfoService.prototype.getSystemVersion = /**
     * @return {?}
     */
    function () {
        return this.getSystemInfo().pipe(map(function (systemInfo) {
            if (!systemInfo) {
                return 0;
            }
            var /** @type {?} */ splitedVersion = systemInfo.version ? systemInfo.version.split('.') : [];
            return parseInt(splitedVersion[1], 10) || 0;
        }));
    };
    SystemInfoService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    SystemInfoService.ctorParameters = function () { return [
        { type: ManifestService },
        { type: HttpClient }
    ]; };
    /** @nocollapse */ SystemInfoService.ngInjectableDef = defineInjectable({ factory: function SystemInfoService_Factory() { return new SystemInfoService(inject(ManifestService), inject(HttpClient)); }, token: SystemInfoService, providedIn: "root" });
    return SystemInfoService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var /** @type {?} */ HTTP_CONFIG = {
    includeVersionNumber: false,
    preferPreviousApiVersion: false,
    useRootUrl: false,
    useIndexDb: false,
    isExternalLink: false
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var IndexDbService = /** @class */ (function () {
    function IndexDbService() {
        this._indexedDB = indexedDB;
        this._dbName = 'db'; // by default
    }
    /**
     * @param {?} dbName
     * @return {?}
     */
    IndexDbService.prototype.setName = /**
     * @param {?} dbName
     * @return {?}
     */
    function (dbName) {
        if (dbName) {
            this._dbName = dbName;
        }
    };
    /**
     * Function to update existing data in the db
     */
    /**
     * Function to update existing data in the db
     * @param {?} schema
     * @param {?} data
     * @return {?}
     */
    IndexDbService.prototype.put = /**
     * Function to update existing data in the db
     * @param {?} schema
     * @param {?} data
     * @return {?}
     */
    function (schema, data) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.create(schema)
                .pipe(switchMap$1(function () { return _this.open(); }))
                .subscribe(function (db) {
                var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                var /** @type {?} */ store = transaction.objectStore(schema.name);
                if (isArray(data)) {
                    each(data, function (dataItem) {
                        store.put(dataItem);
                    });
                }
                else {
                    store.put(data);
                }
                transaction.oncomplete = function () {
                    observer.next(data);
                    db.close();
                    observer.complete();
                };
                db.onerror = function (errorEvent) {
                    db.close();
                    observer.error(errorEvent.target.errorCode);
                };
            });
        });
    };
    /**
     * Function to add new data in the db
     */
    /**
     * Function to add new data in the db
     * @param {?} schema
     * @param {?} data
     * @return {?}
     */
    IndexDbService.prototype.post = /**
     * Function to add new data in the db
     * @param {?} schema
     * @param {?} data
     * @return {?}
     */
    function (schema, data) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.create(schema)
                .pipe(mergeMap(function () { return _this.open(); }))
                .subscribe(function (db) {
                var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                var /** @type {?} */ store = transaction.objectStore(schema.name);
                // Check if data is array or an object
                if (isArray(data)) {
                    each(data, function (dataItem) {
                        store.add(dataItem);
                    });
                }
                else {
                    store.add(data);
                }
                transaction.oncomplete = function () {
                    observer.next(data);
                    db.close();
                    observer.complete();
                };
                db.onerror = function () {
                    observer.next(data);
                    db.close();
                    observer.complete();
                };
            });
        });
    };
    /**
     * Function to get value for a particular key from the table
     */
    /**
     * Function to get value for a particular key from the table
     * @param {?} schema
     * @param {?} key
     * @return {?}
     */
    IndexDbService.prototype.findOne = /**
     * Function to get value for a particular key from the table
     * @param {?} schema
     * @param {?} key
     * @return {?}
     */
    function (schema, key) {
        var _this = this;
        return new Observable(function (observer) {
            _this.create(schema)
                .pipe(mergeMap(function () { return _this.open(); }))
                .subscribe(function (db) {
                var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                var /** @type {?} */ store = transaction.objectStore(schema.name);
                var /** @type {?} */ request = store.get(key);
                request.onsuccess = function (successEvent) {
                    observer.next(successEvent.target.result);
                    db.close();
                    observer.complete();
                };
                db.onerror = function (event) {
                    console.log(event.target.errorCode);
                    db.close();
                    observer.error(event.target.errorCode);
                };
            });
        });
    };
    /**
     * Function to find all values for a particular table in the db
     */
    /**
     * Function to find all values for a particular table in the db
     * @param {?} schema
     * @return {?}
     */
    IndexDbService.prototype.findAll = /**
     * Function to find all values for a particular table in the db
     * @param {?} schema
     * @return {?}
     */
    function (schema) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.create(schema)
                .pipe(switchMap$1(function () { return _this.open(); }))
                .subscribe(function (db) {
                var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                var /** @type {?} */ store = transaction.objectStore(schema.name);
                var /** @type {?} */ storeIndex = store.index(schema.keyPath);
                var /** @type {?} */ request = storeIndex.openCursor();
                var /** @type {?} */ results = [];
                request.onsuccess = function (successEvent) {
                    var /** @type {?} */ cursor = successEvent.target.result;
                    if (cursor) {
                        results = __spread(results, [cursor.value]);
                        cursor.continue();
                    }
                    else {
                        observer.next(results);
                        db.close();
                        observer.complete();
                    }
                };
                db.onerror = function (event) {
                    db.close();
                    observer.error(event.target.errorCode);
                };
            });
        });
    };
    /**
     * Delete data from the db
     */
    /**
     * Delete data from the db
     * @param {?} schema
     * @param {?} key
     * @return {?}
     */
    IndexDbService.prototype.delete = /**
     * Delete data from the db
     * @param {?} schema
     * @param {?} key
     * @return {?}
     */
    function (schema, key) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.open().subscribe(function (db) {
                if (!db.objectStoreNames.contains(schema.name)) {
                    var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                    var /** @type {?} */ store_1 = transaction.objectStore(schema.name);
                    if (isArray(key)) {
                        each(key, function (keyItem) {
                            store_1.delete(keyItem);
                        });
                    }
                    else {
                        store_1.delete(key);
                    }
                    transaction.oncomplete = function () {
                        observer.next(key);
                        db.close();
                        observer.complete();
                    };
                    db.onerror = function (errorEvent) {
                        db.close();
                        observer.error(errorEvent.target.errorCode);
                    };
                }
            });
        });
    };
    /**
     * Create a schema/table
     */
    /**
     * Create a schema/table
     * @param {?} schema
     * @return {?}
     */
    IndexDbService.prototype.create = /**
     * Create a schema/table
     * @param {?} schema
     * @return {?}
     */
    function (schema) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.open().subscribe(function (requestResult) {
                if (!requestResult.objectStoreNames.contains(schema.name)) {
                    /**
                               * Close database to allow opening with new version
                               */
                    requestResult.close();
                    /**
                     * Set a new connection with new version to allows creating schema
                     */
                    var /** @type {?} */ request = _this._indexedDB.open(_this._dbName, requestResult.version + 1);
                    request.onupgradeneeded = function (event) {
                        var /** @type {?} */ db = event.target.result;
                        if (!db.objectStoreNames.contains(schema.name)) {
                            /**
                             * Create corresponding schema
                             */
                            var /** @type {?} */ store_2 = db.createObjectStore(schema.name, {
                                keyPath: schema.keyPath
                            });
                            store_2.createIndex(schema.keyPath, schema.keyPath, {
                                unique: true
                            });
                            /**
                                           * Create indexes for schema if supplied
                                           */
                            if (schema.indexes) {
                                each(schema.indexes, function (schemaIndex) {
                                    store_2.createIndex(schemaIndex, schemaIndex);
                                });
                            }
                            /**
                                           * Add data if supplied
                                           */
                            if (schema.data) {
                                each(schema.data, function (dataItem) {
                                    store_2.put(dataItem);
                                });
                            }
                        }
                        observer.next('done');
                        observer.complete();
                    };
                    request.onerror = function (errorEvent) {
                        observer.error(errorEvent.target.errorCode);
                    };
                    request.onsuccess = function (successEvent) {
                        successEvent.target.result.close();
                        observer.next('done');
                        observer.complete();
                    };
                }
                else {
                    observer.next('done');
                    observer.complete();
                }
            });
        });
    };
    /**
     * Delete the whole database
     */
    /**
     * Delete the whole database
     * @return {?}
     */
    IndexDbService.prototype.clear = /**
     * Delete the whole database
     * @return {?}
     */
    function () {
        var _this = this;
        return Observable.create(function (observer) {
            var /** @type {?} */ request = _this._indexedDB.deleteDatabase(_this._dbName);
            request.onsuccess = function () {
                observer.next('done');
                observer.complete();
            };
            request.onerror = function (errorEvent) {
                observer.error(errorEvent.target.errorCode);
            };
            request.onblocked = function (blockEvent) {
                observer.error(blockEvent.target.errorCode);
            };
        });
    };
    /**
     * @return {?}
     */
    IndexDbService.prototype.open = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return Observable.create(function (observer) {
            var /** @type {?} */ request = _this._indexedDB.open(_this._dbName);
            request.onsuccess = function (successEvent) {
                observer.next(successEvent.target.result);
                observer.complete();
            };
            request.onerror = function (errorEvent) {
                return observer.error(errorEvent.target.errorCode);
            };
        });
    };
    IndexDbService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    IndexDbService.ctorParameters = function () { return []; };
    /** @nocollapse */ IndexDbService.ngInjectableDef = defineInjectable({ factory: function IndexDbService_Factory() { return new IndexDbService(); }, token: IndexDbService, providedIn: "root" });
    return IndexDbService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var NgxDhis2HttpClientService = /** @class */ (function () {
    function NgxDhis2HttpClientService(httpClient, manifestService, systemInfoService, indexDbService) {
        this.httpClient = httpClient;
        this.manifestService = manifestService;
        this.systemInfoService = systemInfoService;
        this.indexDbService = indexDbService;
    }
    /**
     * @param {?} url
     * @param {?=} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype.get = /**
     * @param {?} url
     * @param {?=} httpConfig
     * @return {?}
     */
    function (url, httpConfig) {
        var _this = this;
        var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
        // Make a call directly from url if is external one
        if (newHttpConfig.isExternalLink) {
            return this.httpClient.get(url);
        }
        // load from index db
        if (newHttpConfig.useIndexDb) {
            return this._fetchFromIndexDb(newHttpConfig).pipe(mergeMap$1(function (indexDbResponse) {
                return indexDbResponse
                    ? of(indexDbResponse)
                    : _this._get(url, newHttpConfig).pipe(mergeMap$1(function (response) {
                        return _this._updateIndexDb(newHttpConfig, response);
                    }));
            }));
        }
        return this._get(url, newHttpConfig);
    };
    /**
     * @param {?} url
     * @param {?} data
     * @param {?=} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype.post = /**
     * @param {?} url
     * @param {?} data
     * @param {?=} httpConfig
     * @return {?}
     */
    function (url, data, httpConfig) {
        var _this = this;
        var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
        return this._getSanitizedRootUrl(newHttpConfig).pipe(mergeMap$1(function (rootUrl) {
            return _this.httpClient
                .post(rootUrl + url, data)
                .pipe(mergeMap$1(function (response) {
                var /** @type {?} */ dataId = response.uid;
                return newHttpConfig.useIndexDb
                    ? dataId
                        ? _this._updateIndexDb(newHttpConfig, __assign({}, data, { id: dataId }), 'CREATE').pipe(map(function () { return response; }))
                        : of(response)
                    : of(response);
            }))
                .pipe(catchError(_this._handleError));
        }), catchError(this._handleError));
    };
    /**
     * @param {?} url
     * @param {?} data
     * @param {?=} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype.put = /**
     * @param {?} url
     * @param {?} data
     * @param {?=} httpConfig
     * @return {?}
     */
    function (url, data, httpConfig) {
        var _this = this;
        var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
        return this._getSanitizedRootUrl(newHttpConfig).pipe(mergeMap$1(function (rootUrl) {
            return _this.httpClient.put(rootUrl + url, data).pipe(mergeMap$1(function (response) {
                return newHttpConfig.useIndexDb
                    ? _this._updateIndexDb(newHttpConfig, data, 'UPDATE').pipe(map(function () { return response; }))
                    : of(response);
            }), catchError(_this._handleError));
        }), catchError(this._handleError));
    };
    /**
     * @param {?} url
     * @param {?=} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype.delete = /**
     * @param {?} url
     * @param {?=} httpConfig
     * @return {?}
     */
    function (url, httpConfig) {
        var _this = this;
        var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
        return this._getSanitizedRootUrl(newHttpConfig).pipe(mergeMap$1(function (rootUrl) {
            return _this.httpClient
                .delete(rootUrl + url)
                .pipe(mergeMap$1(function (response) {
                return newHttpConfig.useIndexDb
                    ? _this._updateIndexDb(newHttpConfig, null, 'DELETE').pipe(map(function () { return response; }))
                    : of(response);
            }))
                .pipe(catchError(_this._handleError));
        }), catchError(this._handleError));
    };
    /**
     * @param {?} url
     * @param {?} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._get = /**
     * @param {?} url
     * @param {?} httpConfig
     * @return {?}
     */
    function (url, httpConfig) {
        var _this = this;
        return this._getSanitizedRootUrl(httpConfig).pipe(mergeMap$1(function (rootUrl) {
            return _this.httpClient.get(rootUrl + url).pipe(catchError(_this._handleError));
        }), catchError(this._handleError));
    };
    /**
     * @param {?} err
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._handleError = /**
     * @param {?} err
     * @return {?}
     */
    function (err) {
        var /** @type {?} */ error = null;
        if (err.error instanceof ErrorEvent) {
            // A client-side or network error occurred. Handle it accordingly.
            error = {
                message: err.error,
                status: err.status,
                statusText: err.statusText
            };
        }
        else {
            // The backend returned an unsuccessful response code.
            // The response body may contain clues as to what went wrong,
            error = {
                message: err.error instanceof Object
                    ? err.error.message
                    : err.error || err.message,
                status: err.status,
                statusText: err.statusText
            };
        }
        return throwError(error);
    };
    /**
     * @param {?} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._getSanitizedRootUrl = /**
     * @param {?} httpConfig
     * @return {?}
     */
    function (httpConfig) {
        return httpConfig.useRootUrl
            ? this.manifestService.getRootUrl()
            : this._getApiRootUrl(httpConfig.includeVersionNumber, httpConfig.preferPreviousApiVersion);
    };
    /**
     * @param {?=} includeVersionNumber
     * @param {?=} preferPreviousVersion
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._getApiRootUrl = /**
     * @param {?=} includeVersionNumber
     * @param {?=} preferPreviousVersion
     * @return {?}
     */
    function (includeVersionNumber, preferPreviousVersion) {
        var _this = this;
        if (includeVersionNumber === void 0) { includeVersionNumber = false; }
        if (preferPreviousVersion === void 0) { preferPreviousVersion = false; }
        var /** @type {?} */ rootUrlPromise = this.manifestService.getRootUrl().pipe(switchMap(function (rootUrl) {
            return _this.systemInfoService.getSystemVersion().pipe(map(function (version) {
                return {
                    rootUrl: rootUrl,
                    version: version - 1 <= 25 ? version + 1 : version
                };
            }));
        }));
        return rootUrlPromise.pipe(map(function (urlInfo) {
            return urlInfo.rootUrl + "api/" + (includeVersionNumber && !preferPreviousVersion
                ? urlInfo.version + '/'
                : preferPreviousVersion
                    ? urlInfo.version
                        ? urlInfo.version - 1 + '/'
                        : ''
                    : '');
        }));
    };
    /**
     * @param {?} httpConfig
     * @param {?} requestData
     * @param {?=} action
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._updateIndexDb = /**
     * @param {?} httpConfig
     * @param {?} requestData
     * @param {?=} action
     * @return {?}
     */
    function (httpConfig, requestData, action) {
        if (action === void 0) { action = 'CREATE'; }
        var /** @type {?} */ indexDbSchema = httpConfig.indexDbConfig
            ? httpConfig.indexDbConfig.schema
            : null;
        var /** @type {?} */ arrayKey = httpConfig.indexDbConfig
            ? httpConfig.indexDbConfig.arrayKey
            : null;
        var /** @type {?} */ indexDbKey = httpConfig.indexDbConfig
            ? httpConfig.indexDbConfig.key
            : null;
        var /** @type {?} */ data = arrayKey ? requestData[arrayKey] : requestData;
        switch (action) {
            case 'CREATE':
            case 'UPDATE':
                return (action === 'CREATE'
                    ? this.indexDbService.post(indexDbSchema, data)
                    : this.indexDbService.put(indexDbSchema, data)).pipe(map(function () { return requestData; }), catchError(function (e) {
                    console.warn('Could not save data into index DB, ERROR: ' + e);
                    return of(requestData);
                }));
            case 'DELETE':
                return this.indexDbService.delete(indexDbSchema, indexDbKey).pipe(map(function () { return requestData; }), catchError(function (e) {
                    console.warn('Could not delete data from index DB, ERROR: ' + e);
                    return of(requestData);
                }));
            default:
                console.log('No action has been specified');
                return of(requestData);
        }
    };
    /**
     * @param {?} httpConfig
     * @return {?}
     */
    NgxDhis2HttpClientService.prototype._fetchFromIndexDb = /**
     * @param {?} httpConfig
     * @return {?}
     */
    function (httpConfig) {
        var /** @type {?} */ indexDbSchema = httpConfig.indexDbConfig
            ? httpConfig.indexDbConfig.schema
            : null;
        var /** @type {?} */ indexDbKey = httpConfig.indexDbConfig
            ? httpConfig.indexDbConfig.key
            : null;
        return indexDbKey
            ? this.indexDbService.findOne(indexDbSchema, indexDbKey)
            : this.indexDbService.findAll(indexDbSchema).pipe(map(function (response) {
                var /** @type {?} */ arrayKey = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.arrayKey
                    : null;
                return response.length > 0
                    ? arrayKey
                        ? (_a = {}, _a[arrayKey] = response, _a) : response
                    : null;
                var _a;
            }));
    };
    NgxDhis2HttpClientService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    NgxDhis2HttpClientService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: ManifestService },
        { type: SystemInfoService },
        { type: IndexDbService }
    ]; };
    /** @nocollapse */ NgxDhis2HttpClientService.ngInjectableDef = defineInjectable({ factory: function NgxDhis2HttpClientService_Factory() { return new NgxDhis2HttpClientService(inject(HttpClient), inject(ManifestService), inject(SystemInfoService), inject(IndexDbService)); }, token: NgxDhis2HttpClientService, providedIn: "root" });
    return NgxDhis2HttpClientService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { ManifestService, SystemInfoService, NgxDhis2HttpClientService, IndexDbService };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWFwcHMtbmd4LWRoaXMyLWh0dHAtY2xpZW50LmpzLm1hcCIsInNvdXJjZXMiOlsibmc6Ly9AaWFwcHMvbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9tYW5pZmVzdC5zZXJ2aWNlLnRzIiwibmc6Ly9AaWFwcHMvbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9zeXN0ZW0taW5mby5zZXJ2aWNlLnRzIiwibmc6Ly9AaWFwcHMvbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9jb25zdGFudHMvaHR0cC1jb25maWcuY29uc3RhbnQudHMiLCJuZzovL0BpYXBwcy9uZ3gtZGhpczItaHR0cC1jbGllbnQvbGliL3NlcnZpY2VzL2luZGV4LWRiLnNlcnZpY2UudHMiLCJuZzovL0BpYXBwcy9uZ3gtZGhpczItaHR0cC1jbGllbnQvbGliL3NlcnZpY2VzL25neC1kaGlzMi1odHRwLWNsaWVudC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBNYW5pZmVzdCB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwLCBjYXRjaEVycm9yLCBtYXAgfSBmcm9tICdyeGpzL2ludGVybmFsL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIE1hbmlmZXN0U2VydmljZSB7XG4gIHByaXZhdGUgX21hbmlmZXN0OiBNYW5pZmVzdDtcbiAgcHJpdmF0ZSBfZGVmYXVsdFJvb3RVcmw6IHN0cmluZztcbiAgcHJpdmF0ZSBfbWFuaWZlc3RMb2FkZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XG4gICAgdGhpcy5fZGVmYXVsdFJvb3RVcmwgPSAnLi4vLi4vLi4vJztcbiAgICB0aGlzLl9tYW5pZmVzdExvYWRlZCA9IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIGdldE1hbmlmZXN0KCk6IE9ic2VydmFibGU8TWFuaWZlc3Q+IHtcbiAgICByZXR1cm4gdGhpcy5fbWFuaWZlc3RMb2FkZWQgPyBvZih0aGlzLl9tYW5pZmVzdCkgOiB0aGlzLmh0dHBDbGllbnQuZ2V0PE1hbmlmZXN0PignbWFuaWZlc3Qud2ViYXBwJykucGlwZShcbiAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmlmZXN0IGZpbGUgY291bGQgbm90IGJlIGxvYWRlZCwgZGVmYXVsdCBvcHRpb25zIGhhdmUgYmVlbiB1c2VkIGluc3RlYWQnKTtcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgfSksXG4gICAgICB0YXAoKG1hbmlmZXN0KSA9PiB7XG4gICAgICAgIHRoaXMuX21hbmlmZXN0ID0gbWFuaWZlc3Q7XG4gICAgICAgIHRoaXMuX21hbmlmZXN0TG9hZGVkID0gdHJ1ZTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSb290VXJsKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TWFuaWZlc3QoKS5waXBlKG1hcCgobWFuaWZlc3Q6IE1hbmlmZXN0KSA9PiB7XG4gICAgICBpZiAoIW1hbmlmZXN0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0Um9vdFVybDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtYW5pZmVzdC5hY3Rpdml0aWVzICYmIG1hbmlmZXN0LmFjdGl2aXRpZXMuZGhpcyAmJiBtYW5pZmVzdC5hY3Rpdml0aWVzLmRoaXMuaHJlZiA/XG4gICAgICAgIG1hbmlmZXN0LmFjdGl2aXRpZXMuZGhpcy5ocmVmIDogdGhpcy5fZGVmYXVsdFJvb3RVcmw7XG4gICAgfSkpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBmb3JrSm9pbiwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE1hbmlmZXN0U2VydmljZSB9IGZyb20gJy4vbWFuaWZlc3Quc2VydmljZSc7XG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuQEluamVjdGFibGUoe3Byb3ZpZGVkSW46ICdyb290J30pXG5leHBvcnQgY2xhc3MgU3lzdGVtSW5mb1NlcnZpY2Uge1xuICBwcml2YXRlIF9zeXN0ZW1JbmZvTG9hZGVkOiBib29sZWFuO1xuICBwcml2YXRlIF9zeXN0ZW1JbmZvOiBhbnk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtYW5pZmVzdFNlcnZpY2U6IE1hbmlmZXN0U2VydmljZSwgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XG4gICAgdGhpcy5fc3lzdGVtSW5mb0xvYWRlZCA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0U3lzdGVtSW5mbygpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLl9zeXN0ZW1JbmZvTG9hZGVkID8gb2YodGhpcy5fc3lzdGVtSW5mbykgOlxuICAgICAgdGhpcy5tYW5pZmVzdFNlcnZpY2UuZ2V0Um9vdFVybCgpLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgocm9vdFVybDogc3RyaW5nKSA9PiBmb3JrSm9pbih0aGlzLmh0dHBDbGllbnQuZ2V0KGAke3Jvb3RVcmx9YXBpL3N5c3RlbS9pbmZvYCksXG4gICAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChgJHtyb290VXJsfWFwaS9zeXN0ZW1TZXR0aW5nc2ApKS5waXBlKG1hcCgocmVzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgIHJldHVybiB7Li4ucmVzWzBdLCAuLi5yZXNbMV19O1xuICAgICAgICB9KSwgdGFwKChzeXN0ZW1JbmZvOiBhbnkpID0+IHtcbiAgICAgICAgICB0aGlzLl9zeXN0ZW1JbmZvID0gc3lzdGVtSW5mbztcbiAgICAgICAgICB0aGlzLl9zeXN0ZW1JbmZvTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgfSkpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0U3lzdGVtVmVyc2lvbigpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLmdldFN5c3RlbUluZm8oKS5waXBlKG1hcCgoc3lzdGVtSW5mbzogYW55KSA9PiB7XG4gICAgICBpZiAoIXN5c3RlbUluZm8pIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICBjb25zdCBzcGxpdGVkVmVyc2lvbiA9IHN5c3RlbUluZm8udmVyc2lvbiA/IHN5c3RlbUluZm8udmVyc2lvbi5zcGxpdCgnLicpIDogW107XG4gICAgICByZXR1cm4gcGFyc2VJbnQoc3BsaXRlZFZlcnNpb25bMV0sIDEwKSB8fCAwO1xuICAgIH0pKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSHR0cENvbmZpZyB9IGZyb20gJy4uL21vZGVscy9odHRwLWNvbmZpZy5tb2RlbCc7XG5cbmV4cG9ydCBjb25zdCBIVFRQX0NPTkZJRzogSHR0cENvbmZpZyA9IHtcbiAgaW5jbHVkZVZlcnNpb25OdW1iZXI6IGZhbHNlLFxuICBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb246IGZhbHNlLFxuICB1c2VSb290VXJsOiBmYWxzZSxcbiAgdXNlSW5kZXhEYjogZmFsc2UsXG4gIGlzRXh0ZXJuYWxMaW5rOiBmYWxzZVxufTtcbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHN3aXRjaE1hcCwgbWVyZ2VNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBJbmRleERiU2VydmljZSB7XG4gIHByaXZhdGUgX2luZGV4ZWREQjogYW55O1xuICBwcml2YXRlIF9kYk5hbWU6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9pbmRleGVkREIgPSBpbmRleGVkREI7XG4gICAgdGhpcy5fZGJOYW1lID0gJ2RiJzsgLy8gYnkgZGVmYXVsdFxuICB9XG5cbiAgc2V0TmFtZShkYk5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmIChkYk5hbWUpIHtcbiAgICAgIHRoaXMuX2RiTmFtZSA9IGRiTmFtZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gdG8gdXBkYXRlIGV4aXN0aW5nIGRhdGEgaW4gdGhlIGRiXG4gICAqL1xuICBwdXQoc2NoZW1hOiBhbnksIGRhdGE6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZShzY2hlbWEpXG4gICAgICAgIC5waXBlKHN3aXRjaE1hcCgoKSA9PiB0aGlzLm9wZW4oKSkpXG4gICAgICAgIC5zdWJzY3JpYmUoKGRiOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKHNjaGVtYS5uYW1lLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzY2hlbWEubmFtZSk7XG5cbiAgICAgICAgICBpZiAoXy5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICBfLmVhY2goZGF0YSwgZGF0YUl0ZW0gPT4ge1xuICAgICAgICAgICAgICBzdG9yZS5wdXQoZGF0YUl0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0b3JlLnB1dChkYXRhKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhKTtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgZGIub25lcnJvciA9IChlcnJvckV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvckV2ZW50LnRhcmdldC5lcnJvckNvZGUpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGFkZCBuZXcgZGF0YSBpbiB0aGUgZGJcbiAgICovXG4gIHBvc3Qoc2NoZW1hOiBhbnksIGRhdGE6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZShzY2hlbWEpXG4gICAgICAgIC5waXBlKG1lcmdlTWFwKCgpID0+IHRoaXMub3BlbigpKSlcbiAgICAgICAgLnN1YnNjcmliZSgoZGI6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oc2NoZW1hLm5hbWUsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHNjaGVtYS5uYW1lKTtcblxuICAgICAgICAgIC8vIENoZWNrIGlmIGRhdGEgaXMgYXJyYXkgb3IgYW4gb2JqZWN0XG4gICAgICAgICAgaWYgKF8uaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgXy5lYWNoKGRhdGEsIGRhdGFJdGVtID0+IHtcbiAgICAgICAgICAgICAgc3RvcmUuYWRkKGRhdGFJdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdG9yZS5hZGQoZGF0YSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGRiLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZ2V0IHZhbHVlIGZvciBhIHBhcnRpY3VsYXIga2V5IGZyb20gdGhlIHRhYmxlXG4gICAqL1xuICBmaW5kT25lKHNjaGVtYTogYW55LCBrZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55W10+IHtcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuY3JlYXRlKHNjaGVtYSlcbiAgICAgICAgLnBpcGUobWVyZ2VNYXAoKCkgPT4gdGhpcy5vcGVuKCkpKVxuICAgICAgICAuc3Vic2NyaWJlKChkYjogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihzY2hlbWEubmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc2NoZW1hLm5hbWUpO1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXQoa2V5KTtcbiAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IHN1Y2Nlc3NFdmVudCA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHN1Y2Nlc3NFdmVudC50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgZGIub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihldmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBmaW5kIGFsbCB2YWx1ZXMgZm9yIGEgcGFydGljdWxhciB0YWJsZSBpbiB0aGUgZGJcbiAgICovXG4gIGZpbmRBbGwoc2NoZW1hOiBhbnkpOiBPYnNlcnZhYmxlPGFueVtdPiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZShzY2hlbWEpXG4gICAgICAgIC5waXBlKHN3aXRjaE1hcCgoKSA9PiB0aGlzLm9wZW4oKSkpXG4gICAgICAgIC5zdWJzY3JpYmUoKGRiOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKHNjaGVtYS5uYW1lLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzY2hlbWEubmFtZSk7XG4gICAgICAgICAgY29uc3Qgc3RvcmVJbmRleCA9IHN0b3JlLmluZGV4KHNjaGVtYS5rZXlQYXRoKTtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmVJbmRleC5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgbGV0IHJlc3VsdHM6IGFueVtdID0gW107XG5cbiAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IHN1Y2Nlc3NFdmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCBjdXJzb3IgPSBzdWNjZXNzRXZlbnQudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcbiAgICAgICAgICAgICAgcmVzdWx0cyA9IFsuLi5yZXN1bHRzLCBjdXJzb3IudmFsdWVdO1xuICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG9ic2VydmVyLm5leHQocmVzdWx0cyk7XG4gICAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkYi5vbmVycm9yID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihldmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgZGF0YSBmcm9tIHRoZSBkYlxuICAgKi9cbiAgZGVsZXRlKHNjaGVtYTogYW55LCBrZXk6IHN0cmluZyB8IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgIHRoaXMub3BlbigpLnN1YnNjcmliZSgoZGI6IGFueSkgPT4ge1xuICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoc2NoZW1hLm5hbWUpKSB7XG4gICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihzY2hlbWEubmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc2NoZW1hLm5hbWUpO1xuXG4gICAgICAgICAgaWYgKF8uaXNBcnJheShrZXkpKSB7XG4gICAgICAgICAgICBfLmVhY2goa2V5LCBrZXlJdGVtID0+IHtcbiAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKGtleUl0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0b3JlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGtleSk7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGRiLm9uZXJyb3IgPSAoZXJyb3JFdmVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3JFdmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzY2hlbWEvdGFibGVcbiAgICovXG4gIGNyZWF0ZShzY2hlbWE6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLm9wZW4oKS5zdWJzY3JpYmUoKHJlcXVlc3RSZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoIXJlcXVlc3RSZXN1bHQub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzY2hlbWEubmFtZSkpIHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBDbG9zZSBkYXRhYmFzZSB0byBhbGxvdyBvcGVuaW5nIHdpdGggbmV3IHZlcnNpb25cbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZXF1ZXN0UmVzdWx0LmNsb3NlKCk7XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBTZXQgYSBuZXcgY29ubmVjdGlvbiB3aXRoIG5ldyB2ZXJzaW9uIHRvIGFsbG93cyBjcmVhdGluZyBzY2hlbWFcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5faW5kZXhlZERCLm9wZW4oXG4gICAgICAgICAgICB0aGlzLl9kYk5hbWUsXG4gICAgICAgICAgICByZXF1ZXN0UmVzdWx0LnZlcnNpb24gKyAxXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGIgPSBldmVudC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHNjaGVtYS5uYW1lKSkge1xuICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICogQ3JlYXRlIGNvcnJlc3BvbmRpbmcgc2NoZW1hXG4gICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKHNjaGVtYS5uYW1lLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogc2NoZW1hLmtleVBhdGhcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KHNjaGVtYS5rZXlQYXRoLCBzY2hlbWEua2V5UGF0aCwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogdHJ1ZVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICogQ3JlYXRlIGluZGV4ZXMgZm9yIHNjaGVtYSBpZiBzdXBwbGllZFxuICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaWYgKHNjaGVtYS5pbmRleGVzKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHNjaGVtYS5pbmRleGVzLCAoc2NoZW1hSW5kZXg6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoc2NoZW1hSW5kZXgsIHNjaGVtYUluZGV4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgKiBBZGQgZGF0YSBpZiBzdXBwbGllZFxuICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaWYgKHNjaGVtYS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHNjaGVtYS5kYXRhLCAoZGF0YUl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgc3RvcmUucHV0KGRhdGFJdGVtKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KCdkb25lJyk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBlcnJvckV2ZW50ID0+IHtcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yRXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gc3VjY2Vzc0V2ZW50ID0+IHtcbiAgICAgICAgICAgIHN1Y2Nlc3NFdmVudC50YXJnZXQucmVzdWx0LmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KCdkb25lJyk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCgnZG9uZScpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSB0aGUgd2hvbGUgZGF0YWJhc2VcbiAgICovXG4gIGNsZWFyKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5faW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKHRoaXMuX2RiTmFtZSk7XG5cbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICBvYnNlcnZlci5uZXh0KCdkb25lJyk7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZXJyb3JFdmVudCA9PiB7XG4gICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yRXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmJsb2NrZWQgPSBibG9ja0V2ZW50ID0+IHtcbiAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoYmxvY2tFdmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG9wZW4oKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLl9pbmRleGVkREIub3Blbih0aGlzLl9kYk5hbWUpO1xuXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IHN1Y2Nlc3NFdmVudCA9PiB7XG4gICAgICAgIG9ic2VydmVyLm5leHQoc3VjY2Vzc0V2ZW50LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGVycm9yRXZlbnQgPT5cbiAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3JFdmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBNYW5pZmVzdFNlcnZpY2UgfSBmcm9tICcuL21hbmlmZXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgU3lzdGVtSW5mb1NlcnZpY2UgfSBmcm9tICcuL3N5c3RlbS1pbmZvLnNlcnZpY2UnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGNhdGNoRXJyb3IsXG4gIG1hcCxcbiAgbWVyZ2VNYXAsXG4gIHN3aXRjaE1hcCxcbiAgdGFwXG59IGZyb20gJ3J4anMvaW50ZXJuYWwvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBDb25maWcsIEluZGV4RGJTY2hlbWEgfSBmcm9tICcuLi9tb2RlbHMvaHR0cC1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgSFRUUF9DT05GSUcgfSBmcm9tICcuLi9jb25zdGFudHMvaHR0cC1jb25maWcuY29uc3RhbnQnO1xuaW1wb3J0IHsgSW5kZXhEYlNlcnZpY2UgfSBmcm9tICcuL2luZGV4LWRiLnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIE5neERoaXMySHR0cENsaWVudFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBtYW5pZmVzdFNlcnZpY2U6IE1hbmlmZXN0U2VydmljZSxcbiAgICBwcml2YXRlIHN5c3RlbUluZm9TZXJ2aWNlOiBTeXN0ZW1JbmZvU2VydmljZSxcbiAgICBwcml2YXRlIGluZGV4RGJTZXJ2aWNlOiBJbmRleERiU2VydmljZVxuICApIHt9XG5cbiAgZ2V0KHVybDogc3RyaW5nLCBodHRwQ29uZmlnPzogSHR0cENvbmZpZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgbmV3SHR0cENvbmZpZyA9IHsgLi4uSFRUUF9DT05GSUcsIC4uLmh0dHBDb25maWcgfTtcblxuICAgIC8vIE1ha2UgYSBjYWxsIGRpcmVjdGx5IGZyb20gdXJsIGlmIGlzIGV4dGVybmFsIG9uZVxuICAgIGlmIChuZXdIdHRwQ29uZmlnLmlzRXh0ZXJuYWxMaW5rKSB7XG4gICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh1cmwpO1xuICAgIH1cblxuICAgIC8vIGxvYWQgZnJvbSBpbmRleCBkYlxuICAgIGlmIChuZXdIdHRwQ29uZmlnLnVzZUluZGV4RGIpIHtcbiAgICAgIHJldHVybiB0aGlzLl9mZXRjaEZyb21JbmRleERiKG5ld0h0dHBDb25maWcpLnBpcGUoXG4gICAgICAgIG1lcmdlTWFwKChpbmRleERiUmVzcG9uc2U6IGFueSkgPT5cbiAgICAgICAgICBpbmRleERiUmVzcG9uc2VcbiAgICAgICAgICAgID8gb2YoaW5kZXhEYlJlc3BvbnNlKVxuICAgICAgICAgICAgOiB0aGlzLl9nZXQodXJsLCBuZXdIdHRwQ29uZmlnKS5waXBlKFxuICAgICAgICAgICAgICAgIG1lcmdlTWFwKChyZXNwb25zZTogYW55KSA9PlxuICAgICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSW5kZXhEYihuZXdIdHRwQ29uZmlnLCByZXNwb25zZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fZ2V0KHVybCwgbmV3SHR0cENvbmZpZyk7XG4gIH1cblxuICBwb3N0KHVybDogc3RyaW5nLCBkYXRhOiBhbnksIGh0dHBDb25maWc/OiBIdHRwQ29uZmlnKSB7XG4gICAgY29uc3QgbmV3SHR0cENvbmZpZyA9IHsgLi4uSFRUUF9DT05GSUcsIC4uLmh0dHBDb25maWcgfTtcblxuICAgIHJldHVybiB0aGlzLl9nZXRTYW5pdGl6ZWRSb290VXJsKG5ld0h0dHBDb25maWcpLnBpcGUoXG4gICAgICBtZXJnZU1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgIC5wb3N0KHJvb3RVcmwgKyB1cmwsIGRhdGEpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBtZXJnZU1hcCgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSByZXNwb25zZS51aWQ7XG4gICAgICAgICAgICAgIHJldHVybiBuZXdIdHRwQ29uZmlnLnVzZUluZGV4RGJcbiAgICAgICAgICAgICAgICA/IGRhdGFJZFxuICAgICAgICAgICAgICAgICAgPyB0aGlzLl91cGRhdGVJbmRleERiKFxuICAgICAgICAgICAgICAgICAgICAgIG5ld0h0dHBDb25maWcsXG4gICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkYXRhSWRcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICdDUkVBVEUnXG4gICAgICAgICAgICAgICAgICAgICkucGlwZShtYXAoKCkgPT4gcmVzcG9uc2UpKVxuICAgICAgICAgICAgICAgICAgOiBvZihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICA6IG9mKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpKVxuICAgICAgKSxcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpXG4gICAgKTtcbiAgfVxuXG4gIHB1dCh1cmw6IHN0cmluZywgZGF0YTogYW55LCBodHRwQ29uZmlnPzogSHR0cENvbmZpZykge1xuICAgIGNvbnN0IG5ld0h0dHBDb25maWcgPSB7IC4uLkhUVFBfQ09ORklHLCAuLi5odHRwQ29uZmlnIH07XG5cbiAgICByZXR1cm4gdGhpcy5fZ2V0U2FuaXRpemVkUm9vdFVybChuZXdIdHRwQ29uZmlnKS5waXBlKFxuICAgICAgbWVyZ2VNYXAocm9vdFVybCA9PlxuICAgICAgICB0aGlzLmh0dHBDbGllbnQucHV0KHJvb3RVcmwgKyB1cmwsIGRhdGEpLnBpcGUoXG4gICAgICAgICAgbWVyZ2VNYXAoKHJlc3BvbnNlOiBhbnkpID0+XG4gICAgICAgICAgICBuZXdIdHRwQ29uZmlnLnVzZUluZGV4RGJcbiAgICAgICAgICAgICAgPyB0aGlzLl91cGRhdGVJbmRleERiKG5ld0h0dHBDb25maWcsIGRhdGEsICdVUERBVEUnKS5waXBlKFxuICAgICAgICAgICAgICAgICAgbWFwKCgpID0+IHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgOiBvZihyZXNwb25zZSlcbiAgICAgICAgICApLFxuICAgICAgICAgIGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICBkZWxldGUodXJsOiBzdHJpbmcsIGh0dHBDb25maWc/OiBIdHRwQ29uZmlnKSB7XG4gICAgY29uc3QgbmV3SHR0cENvbmZpZyA9IHsgLi4uSFRUUF9DT05GSUcsIC4uLmh0dHBDb25maWcgfTtcblxuICAgIHJldHVybiB0aGlzLl9nZXRTYW5pdGl6ZWRSb290VXJsKG5ld0h0dHBDb25maWcpLnBpcGUoXG4gICAgICBtZXJnZU1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgIC5kZWxldGUocm9vdFVybCArIHVybClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIG1lcmdlTWFwKChyZXNwb25zZTogYW55KSA9PlxuICAgICAgICAgICAgICBuZXdIdHRwQ29uZmlnLnVzZUluZGV4RGJcbiAgICAgICAgICAgICAgICA/IHRoaXMuX3VwZGF0ZUluZGV4RGIobmV3SHR0cENvbmZpZywgbnVsbCwgJ0RFTEVURScpLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgIG1hcCgoKSA9PiByZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICA6IG9mKHJlc3BvbnNlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKSlcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICAvLyBwcml2YXRlIG1ldGhvZHNcblxuICBwcml2YXRlIF9nZXQodXJsLCBodHRwQ29uZmlnOiBIdHRwQ29uZmlnKSB7XG4gICAgcmV0dXJuIHRoaXMuX2dldFNhbml0aXplZFJvb3RVcmwoaHR0cENvbmZpZykucGlwZShcbiAgICAgIG1lcmdlTWFwKHJvb3RVcmwgPT5cbiAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgdXJsKS5waXBlKGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpKVxuICAgICAgKSxcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpXG4gICAgKTtcbiAgfVxuICBwcml2YXRlIF9oYW5kbGVFcnJvcihlcnI6IEh0dHBFcnJvclJlc3BvbnNlKSB7XG4gICAgbGV0IGVycm9yID0gbnVsbDtcbiAgICBpZiAoZXJyLmVycm9yIGluc3RhbmNlb2YgRXJyb3JFdmVudCkge1xuICAgICAgLy8gQSBjbGllbnQtc2lkZSBvciBuZXR3b3JrIGVycm9yIG9jY3VycmVkLiBIYW5kbGUgaXQgYWNjb3JkaW5nbHkuXG4gICAgICBlcnJvciA9IHtcbiAgICAgICAgbWVzc2FnZTogZXJyLmVycm9yLFxuICAgICAgICBzdGF0dXM6IGVyci5zdGF0dXMsXG4gICAgICAgIHN0YXR1c1RleHQ6IGVyci5zdGF0dXNUZXh0XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGUgYmFja2VuZCByZXR1cm5lZCBhbiB1bnN1Y2Nlc3NmdWwgcmVzcG9uc2UgY29kZS5cbiAgICAgIC8vIFRoZSByZXNwb25zZSBib2R5IG1heSBjb250YWluIGNsdWVzIGFzIHRvIHdoYXQgd2VudCB3cm9uZyxcbiAgICAgIGVycm9yID0ge1xuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgIGVyci5lcnJvciBpbnN0YW5jZW9mIE9iamVjdFxuICAgICAgICAgICAgPyBlcnIuZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiBlcnIuZXJyb3IgfHwgZXJyLm1lc3NhZ2UsXG4gICAgICAgIHN0YXR1czogZXJyLnN0YXR1cyxcbiAgICAgICAgc3RhdHVzVGV4dDogZXJyLnN0YXR1c1RleHRcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yKTtcbiAgfVxuXG4gIHByaXZhdGUgX2dldFNhbml0aXplZFJvb3RVcmwoaHR0cENvbmZpZzogSHR0cENvbmZpZykge1xuICAgIHJldHVybiBodHRwQ29uZmlnLnVzZVJvb3RVcmxcbiAgICAgID8gdGhpcy5tYW5pZmVzdFNlcnZpY2UuZ2V0Um9vdFVybCgpXG4gICAgICA6IHRoaXMuX2dldEFwaVJvb3RVcmwoXG4gICAgICAgICAgaHR0cENvbmZpZy5pbmNsdWRlVmVyc2lvbk51bWJlcixcbiAgICAgICAgICBodHRwQ29uZmlnLnByZWZlclByZXZpb3VzQXBpVmVyc2lvblxuICAgICAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0QXBpUm9vdFVybChcbiAgICBpbmNsdWRlVmVyc2lvbk51bWJlcjogYm9vbGVhbiA9IGZhbHNlLFxuICAgIHByZWZlclByZXZpb3VzVmVyc2lvbjogYm9vbGVhbiA9IGZhbHNlXG4gICkge1xuICAgIGNvbnN0IHJvb3RVcmxQcm9taXNlID0gdGhpcy5tYW5pZmVzdFNlcnZpY2UuZ2V0Um9vdFVybCgpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAocm9vdFVybCA9PlxuICAgICAgICB0aGlzLnN5c3RlbUluZm9TZXJ2aWNlLmdldFN5c3RlbVZlcnNpb24oKS5waXBlKFxuICAgICAgICAgIG1hcCgodmVyc2lvbjogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICByb290VXJsLFxuICAgICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uIC0gMSA8PSAyNSA/IHZlcnNpb24gKyAxIDogdmVyc2lvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4gcm9vdFVybFByb21pc2UucGlwZShcbiAgICAgIG1hcChcbiAgICAgICAgKHVybEluZm86IHsgcm9vdFVybDogc3RyaW5nOyB2ZXJzaW9uOiBudW1iZXIgfSkgPT5cbiAgICAgICAgICBgJHt1cmxJbmZvLnJvb3RVcmx9YXBpLyR7XG4gICAgICAgICAgICBpbmNsdWRlVmVyc2lvbk51bWJlciAmJiAhcHJlZmVyUHJldmlvdXNWZXJzaW9uXG4gICAgICAgICAgICAgID8gdXJsSW5mby52ZXJzaW9uICsgJy8nXG4gICAgICAgICAgICAgIDogcHJlZmVyUHJldmlvdXNWZXJzaW9uXG4gICAgICAgICAgICAgID8gdXJsSW5mby52ZXJzaW9uXG4gICAgICAgICAgICAgICAgPyB1cmxJbmZvLnZlcnNpb24gLSAxICsgJy8nXG4gICAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgfWBcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlSW5kZXhEYihcbiAgICBodHRwQ29uZmlnOiBIdHRwQ29uZmlnLFxuICAgIHJlcXVlc3REYXRhOiBhbnksXG4gICAgYWN0aW9uOiBzdHJpbmcgPSAnQ1JFQVRFJ1xuICApIHtcbiAgICBjb25zdCBpbmRleERiU2NoZW1hOiBJbmRleERiU2NoZW1hID0gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnXG4gICAgICA/IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZy5zY2hlbWFcbiAgICAgIDogbnVsbDtcblxuICAgIGNvbnN0IGFycmF5S2V5ID0gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnXG4gICAgICA/IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZy5hcnJheUtleVxuICAgICAgOiBudWxsO1xuXG4gICAgY29uc3QgaW5kZXhEYktleSA9IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZ1xuICAgICAgPyBodHRwQ29uZmlnLmluZGV4RGJDb25maWcua2V5XG4gICAgICA6IG51bGw7XG5cbiAgICBjb25zdCBkYXRhID0gYXJyYXlLZXkgPyByZXF1ZXN0RGF0YVthcnJheUtleV0gOiByZXF1ZXN0RGF0YTtcblxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICBjYXNlICdDUkVBVEUnOlxuICAgICAgY2FzZSAnVVBEQVRFJzpcbiAgICAgICAgcmV0dXJuIChhY3Rpb24gPT09ICdDUkVBVEUnXG4gICAgICAgICAgPyB0aGlzLmluZGV4RGJTZXJ2aWNlLnBvc3QoaW5kZXhEYlNjaGVtYSwgZGF0YSlcbiAgICAgICAgICA6IHRoaXMuaW5kZXhEYlNlcnZpY2UucHV0KGluZGV4RGJTY2hlbWEsIGRhdGEpXG4gICAgICAgICkucGlwZShcbiAgICAgICAgICBtYXAoKCkgPT4gcmVxdWVzdERhdGEpLFxuICAgICAgICAgIGNhdGNoRXJyb3IoZSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBzYXZlIGRhdGEgaW50byBpbmRleCBEQiwgRVJST1I6ICcgKyBlKTtcbiAgICAgICAgICAgIHJldHVybiBvZihyZXF1ZXN0RGF0YSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ0RFTEVURSc6XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4RGJTZXJ2aWNlLmRlbGV0ZShpbmRleERiU2NoZW1hLCBpbmRleERiS2V5KS5waXBlKFxuICAgICAgICAgIG1hcCgoKSA9PiByZXF1ZXN0RGF0YSksXG4gICAgICAgICAgY2F0Y2hFcnJvcihlID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGRlbGV0ZSBkYXRhIGZyb20gaW5kZXggREIsIEVSUk9SOiAnICsgZSk7XG4gICAgICAgICAgICByZXR1cm4gb2YocmVxdWVzdERhdGEpO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLmxvZygnTm8gYWN0aW9uIGhhcyBiZWVuIHNwZWNpZmllZCcpO1xuICAgICAgICByZXR1cm4gb2YocmVxdWVzdERhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2ZldGNoRnJvbUluZGV4RGIoaHR0cENvbmZpZzogSHR0cENvbmZpZykge1xuICAgIGNvbnN0IGluZGV4RGJTY2hlbWE6IEluZGV4RGJTY2hlbWEgPSBodHRwQ29uZmlnLmluZGV4RGJDb25maWdcbiAgICAgID8gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnLnNjaGVtYVxuICAgICAgOiBudWxsO1xuXG4gICAgY29uc3QgaW5kZXhEYktleSA9IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZ1xuICAgICAgPyBodHRwQ29uZmlnLmluZGV4RGJDb25maWcua2V5XG4gICAgICA6IG51bGw7XG5cbiAgICByZXR1cm4gaW5kZXhEYktleVxuICAgICAgPyB0aGlzLmluZGV4RGJTZXJ2aWNlLmZpbmRPbmUoaW5kZXhEYlNjaGVtYSwgaW5kZXhEYktleSlcbiAgICAgIDogdGhpcy5pbmRleERiU2VydmljZS5maW5kQWxsKGluZGV4RGJTY2hlbWEpLnBpcGUoXG4gICAgICAgICAgbWFwKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFycmF5S2V5ID0gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnXG4gICAgICAgICAgICAgID8gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnLmFycmF5S2V5XG4gICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgID8gYXJyYXlLZXlcbiAgICAgICAgICAgICAgICA/IHsgW2FycmF5S2V5XTogcmVzcG9uc2UgfVxuICAgICAgICAgICAgICAgIDogcmVzcG9uc2VcbiAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJzd2l0Y2hNYXAiLCJfLmlzQXJyYXkiLCJfLmVhY2giLCJtZXJnZU1hcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7SUFZRSx5QkFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN4QyxJQUFJLENBQUMsZUFBZSxHQUFHLFdBQVcsQ0FBQztRQUNuQyxJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztLQUM5Qjs7OztJQUVNLHFDQUFXOzs7OztRQUNoQixPQUFPLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBVyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FDdEcsVUFBVSxDQUFDO1lBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQywyRUFBMkUsQ0FBQyxDQUFDO1lBQzFGLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2pCLENBQUMsRUFDRixHQUFHLENBQUMsVUFBQyxRQUFRO1lBQ1gsS0FBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7WUFDMUIsS0FBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7U0FDN0IsQ0FBQyxDQUFDLENBQUM7Ozs7O0lBR0Qsb0NBQVU7Ozs7O1FBQ2YsT0FBTyxJQUFJ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
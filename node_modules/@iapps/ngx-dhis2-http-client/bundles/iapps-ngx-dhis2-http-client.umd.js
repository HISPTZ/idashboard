(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/common/http'), require('rxjs'), require('rxjs/internal/operators'), require('lodash'), require('rxjs/operators')) :
    typeof define === 'function' && define.amd ? define('@iapps/ngx-dhis2-http-client', ['exports', '@angular/core', '@angular/common/http', 'rxjs', 'rxjs/internal/operators', 'lodash', 'rxjs/operators'], factory) :
    (factory((global.iapps = global.iapps || {}, global.iapps['ngx-dhis2-http-client'] = {}),global.ng.core,global.ng.common.http,global.rxjs,global.rxjs['internal/operators'],null,global.rxjs.operators));
}(this, (function (exports,i0,i1,rxjs,operators,_,operators$1) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var ManifestService = (function () {
        function ManifestService(httpClient) {
            this.httpClient = httpClient;
            this._defaultRootUrl = '../../../';
            this._manifestLoaded = false;
        }
        /**
         * @return {?}
         */
        ManifestService.prototype.getManifest = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this._manifestLoaded ? rxjs.of(this._manifest) : this.httpClient.get('manifest.webapp').pipe(operators.catchError(function () {
                    console.warn('Manifest file could not be loaded, default options have been used instead');
                    return rxjs.of(null);
                }), operators.tap(function (manifest) {
                    _this._manifest = manifest;
                    _this._manifestLoaded = true;
                }));
            };
        /**
         * @return {?}
         */
        ManifestService.prototype.getRootUrl = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this.getManifest().pipe(operators.map(function (manifest) {
                    if (!manifest) {
                        return _this._defaultRootUrl;
                    }
                    return manifest.activities && manifest.activities.dhis && manifest.activities.dhis.href ?
                        manifest.activities.dhis.href : _this._defaultRootUrl;
                }));
            };
        ManifestService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        ManifestService.ctorParameters = function () {
            return [
                { type: i1.HttpClient }
            ];
        };
        /** @nocollapse */ ManifestService.ngInjectableDef = i0.defineInjectable({ factory: function ManifestService_Factory() { return new ManifestService(i0.inject(i1.HttpClient)); }, token: ManifestService, providedIn: "root" });
        return ManifestService;
    }());

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    var __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
                if (Object.prototype.hasOwnProperty.call(s, p))
                    t[p] = s[p];
        }
        return t;
    };
    function __read(o, n) {
        var m = typeof Symbol === "function" && o[Symbol.iterator];
        if (!m)
            return o;
        var i = m.call(o), r, ar = [], e;
        try {
            while ((n === void 0 || n-- > 0) && !(r = i.next()).done)
                ar.push(r.value);
        }
        catch (error) {
            e = { error: error };
        }
        finally {
            try {
                if (r && !r.done && (m = i["return"]))
                    m.call(i);
            }
            finally {
                if (e)
                    throw e.error;
            }
        }
        return ar;
    }
    function __spread() {
        for (var ar = [], i = 0; i < arguments.length; i++)
            ar = ar.concat(__read(arguments[i]));
        return ar;
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var SystemInfoService = (function () {
        function SystemInfoService(manifestService, httpClient) {
            this.manifestService = manifestService;
            this.httpClient = httpClient;
            this._systemInfoLoaded = false;
        }
        /**
         * @return {?}
         */
        SystemInfoService.prototype.getSystemInfo = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this._systemInfoLoaded ? rxjs.of(this._systemInfo) :
                    this.manifestService.getRootUrl().pipe(operators.switchMap(function (rootUrl) {
                        return rxjs.forkJoin(_this.httpClient.get(rootUrl + "api/system/info"), _this.httpClient.get(rootUrl + "api/systemSettings")).pipe(operators.map(function (res) {
                            return __assign({}, res[0], res[1]);
                        }), operators.tap(function (systemInfo) {
                            _this._systemInfo = systemInfo;
                            _this._systemInfoLoaded = true;
                        }));
                    }));
            };
        /**
         * @return {?}
         */
        SystemInfoService.prototype.getSystemVersion = /**
         * @return {?}
         */
            function () {
                return this.getSystemInfo().pipe(operators.map(function (systemInfo) {
                    if (!systemInfo) {
                        return 0;
                    }
                    var /** @type {?} */ splitedVersion = systemInfo.version ? systemInfo.version.split('.') : [];
                    return parseInt(splitedVersion[1], 10) || 0;
                }));
            };
        SystemInfoService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        SystemInfoService.ctorParameters = function () {
            return [
                { type: ManifestService },
                { type: i1.HttpClient }
            ];
        };
        /** @nocollapse */ SystemInfoService.ngInjectableDef = i0.defineInjectable({ factory: function SystemInfoService_Factory() { return new SystemInfoService(i0.inject(ManifestService), i0.inject(i1.HttpClient)); }, token: SystemInfoService, providedIn: "root" });
        return SystemInfoService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var /** @type {?} */ HTTP_CONFIG = {
        includeVersionNumber: false,
        preferPreviousApiVersion: false,
        useRootUrl: false,
        useIndexDb: false,
        isExternalLink: false
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var IndexDbService = (function () {
        function IndexDbService() {
            this._indexedDB = indexedDB;
            this._dbName = 'db'; // by default
        }
        /**
         * @param {?} dbName
         * @return {?}
         */
        IndexDbService.prototype.setName = /**
         * @param {?} dbName
         * @return {?}
         */
            function (dbName) {
                if (dbName) {
                    this._dbName = dbName;
                }
            };
        /**
         * Function to update existing data in the db
         */
        /**
         * Function to update existing data in the db
         * @param {?} schema
         * @param {?} data
         * @return {?}
         */
        IndexDbService.prototype.put = /**
         * Function to update existing data in the db
         * @param {?} schema
         * @param {?} data
         * @return {?}
         */
            function (schema, data) {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    _this.create(schema)
                        .pipe(operators$1.switchMap(function () { return _this.open(); }))
                        .subscribe(function (db) {
                        var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                        var /** @type {?} */ store = transaction.objectStore(schema.name);
                        if (_.isArray(data)) {
                            _.each(data, function (dataItem) {
                                store.put(dataItem);
                            });
                        }
                        else {
                            store.put(data);
                        }
                        transaction.oncomplete = function () {
                            observer.next(data);
                            db.close();
                            observer.complete();
                        };
                        db.onerror = function (errorEvent) {
                            db.close();
                            observer.error(errorEvent.target.errorCode);
                        };
                    });
                });
            };
        /**
         * Function to add new data in the db
         */
        /**
         * Function to add new data in the db
         * @param {?} schema
         * @param {?} data
         * @return {?}
         */
        IndexDbService.prototype.post = /**
         * Function to add new data in the db
         * @param {?} schema
         * @param {?} data
         * @return {?}
         */
            function (schema, data) {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    _this.create(schema)
                        .pipe(operators$1.mergeMap(function () { return _this.open(); }))
                        .subscribe(function (db) {
                        var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                        var /** @type {?} */ store = transaction.objectStore(schema.name);
                        // Check if data is array or an object
                        if (_.isArray(data)) {
                            _.each(data, function (dataItem) {
                                store.add(dataItem);
                            });
                        }
                        else {
                            store.add(data);
                        }
                        transaction.oncomplete = function () {
                            observer.next(data);
                            db.close();
                            observer.complete();
                        };
                        db.onerror = function () {
                            observer.next(data);
                            db.close();
                            observer.complete();
                        };
                    });
                });
            };
        /**
         * Function to get value for a particular key from the table
         */
        /**
         * Function to get value for a particular key from the table
         * @param {?} schema
         * @param {?} key
         * @return {?}
         */
        IndexDbService.prototype.findOne = /**
         * Function to get value for a particular key from the table
         * @param {?} schema
         * @param {?} key
         * @return {?}
         */
            function (schema, key) {
                var _this = this;
                return new rxjs.Observable(function (observer) {
                    _this.create(schema)
                        .pipe(operators$1.mergeMap(function () { return _this.open(); }))
                        .subscribe(function (db) {
                        var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                        var /** @type {?} */ store = transaction.objectStore(schema.name);
                        var /** @type {?} */ request = store.get(key);
                        request.onsuccess = function (successEvent) {
                            observer.next(successEvent.target.result);
                            db.close();
                            observer.complete();
                        };
                        db.onerror = function (event) {
                            console.log(event.target.errorCode);
                            db.close();
                            observer.error(event.target.errorCode);
                        };
                    });
                });
            };
        /**
         * Function to find all values for a particular table in the db
         */
        /**
         * Function to find all values for a particular table in the db
         * @param {?} schema
         * @return {?}
         */
        IndexDbService.prototype.findAll = /**
         * Function to find all values for a particular table in the db
         * @param {?} schema
         * @return {?}
         */
            function (schema) {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    _this.create(schema)
                        .pipe(operators$1.switchMap(function () { return _this.open(); }))
                        .subscribe(function (db) {
                        var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                        var /** @type {?} */ store = transaction.objectStore(schema.name);
                        var /** @type {?} */ storeIndex = store.index(schema.keyPath);
                        var /** @type {?} */ request = storeIndex.openCursor();
                        var /** @type {?} */ results = [];
                        request.onsuccess = function (successEvent) {
                            var /** @type {?} */ cursor = successEvent.target.result;
                            if (cursor) {
                                results = __spread(results, [cursor.value]);
                                cursor.continue();
                            }
                            else {
                                observer.next(results);
                                db.close();
                                observer.complete();
                            }
                        };
                        db.onerror = function (event) {
                            db.close();
                            observer.error(event.target.errorCode);
                        };
                    });
                });
            };
        /**
         * Delete data from the db
         */
        /**
         * Delete data from the db
         * @param {?} schema
         * @param {?} key
         * @return {?}
         */
        IndexDbService.prototype.delete = /**
         * Delete data from the db
         * @param {?} schema
         * @param {?} key
         * @return {?}
         */
            function (schema, key) {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    _this.open().subscribe(function (db) {
                        if (!db.objectStoreNames.contains(schema.name)) {
                            var /** @type {?} */ transaction = db.transaction(schema.name, 'readwrite');
                            var /** @type {?} */ store_1 = transaction.objectStore(schema.name);
                            if (_.isArray(key)) {
                                _.each(key, function (keyItem) {
                                    store_1.delete(keyItem);
                                });
                            }
                            else {
                                store_1.delete(key);
                            }
                            transaction.oncomplete = function () {
                                observer.next(key);
                                db.close();
                                observer.complete();
                            };
                            db.onerror = function (errorEvent) {
                                db.close();
                                observer.error(errorEvent.target.errorCode);
                            };
                        }
                    });
                });
            };
        /**
         * Create a schema/table
         */
        /**
         * Create a schema/table
         * @param {?} schema
         * @return {?}
         */
        IndexDbService.prototype.create = /**
         * Create a schema/table
         * @param {?} schema
         * @return {?}
         */
            function (schema) {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    _this.open().subscribe(function (requestResult) {
                        if (!requestResult.objectStoreNames.contains(schema.name)) {
                            /**
                                       * Close database to allow opening with new version
                                       */
                            requestResult.close();
                            /**
                             * Set a new connection with new version to allows creating schema
                             */
                            var /** @type {?} */ request = _this._indexedDB.open(_this._dbName, requestResult.version + 1);
                            request.onupgradeneeded = function (event) {
                                var /** @type {?} */ db = event.target.result;
                                if (!db.objectStoreNames.contains(schema.name)) {
                                    /**
                                     * Create corresponding schema
                                     */
                                    var /** @type {?} */ store_2 = db.createObjectStore(schema.name, {
                                        keyPath: schema.keyPath
                                    });
                                    store_2.createIndex(schema.keyPath, schema.keyPath, {
                                        unique: true
                                    });
                                    /**
                                                   * Create indexes for schema if supplied
                                                   */
                                    if (schema.indexes) {
                                        _.each(schema.indexes, function (schemaIndex) {
                                            store_2.createIndex(schemaIndex, schemaIndex);
                                        });
                                    }
                                    /**
                                                   * Add data if supplied
                                                   */
                                    if (schema.data) {
                                        _.each(schema.data, function (dataItem) {
                                            store_2.put(dataItem);
                                        });
                                    }
                                }
                                observer.next('done');
                                observer.complete();
                            };
                            request.onerror = function (errorEvent) {
                                observer.error(errorEvent.target.errorCode);
                            };
                            request.onsuccess = function (successEvent) {
                                successEvent.target.result.close();
                                observer.next('done');
                                observer.complete();
                            };
                        }
                        else {
                            observer.next('done');
                            observer.complete();
                        }
                    });
                });
            };
        /**
         * Delete the whole database
         */
        /**
         * Delete the whole database
         * @return {?}
         */
        IndexDbService.prototype.clear = /**
         * Delete the whole database
         * @return {?}
         */
            function () {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    var /** @type {?} */ request = _this._indexedDB.deleteDatabase(_this._dbName);
                    request.onsuccess = function () {
                        observer.next('done');
                        observer.complete();
                    };
                    request.onerror = function (errorEvent) {
                        observer.error(errorEvent.target.errorCode);
                    };
                    request.onblocked = function (blockEvent) {
                        observer.error(blockEvent.target.errorCode);
                    };
                });
            };
        /**
         * @return {?}
         */
        IndexDbService.prototype.open = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return rxjs.Observable.create(function (observer) {
                    var /** @type {?} */ request = _this._indexedDB.open(_this._dbName);
                    request.onsuccess = function (successEvent) {
                        observer.next(successEvent.target.result);
                        observer.complete();
                    };
                    request.onerror = function (errorEvent) {
                        return observer.error(errorEvent.target.errorCode);
                    };
                });
            };
        IndexDbService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        IndexDbService.ctorParameters = function () { return []; };
        /** @nocollapse */ IndexDbService.ngInjectableDef = i0.defineInjectable({ factory: function IndexDbService_Factory() { return new IndexDbService(); }, token: IndexDbService, providedIn: "root" });
        return IndexDbService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var NgxDhis2HttpClientService = (function () {
        function NgxDhis2HttpClientService(httpClient, manifestService, systemInfoService, indexDbService) {
            this.httpClient = httpClient;
            this.manifestService = manifestService;
            this.systemInfoService = systemInfoService;
            this.indexDbService = indexDbService;
        }
        /**
         * @param {?} url
         * @param {?=} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.get = /**
         * @param {?} url
         * @param {?=} httpConfig
         * @return {?}
         */
            function (url, httpConfig) {
                var _this = this;
                var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
                // Make a call directly from url if is external one
                if (newHttpConfig.isExternalLink) {
                    return this.httpClient.get(url);
                }
                // load from index db
                if (newHttpConfig.useIndexDb) {
                    return this._fetchFromIndexDb(newHttpConfig).pipe(operators.mergeMap(function (indexDbResponse) {
                        return indexDbResponse
                            ? rxjs.of(indexDbResponse)
                            : _this._get(url, newHttpConfig).pipe(operators.mergeMap(function (response) {
                                return _this._updateIndexDb(newHttpConfig, response);
                            }));
                    }));
                }
                return this._get(url, newHttpConfig);
            };
        /**
         * @param {?} url
         * @param {?} data
         * @param {?=} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.post = /**
         * @param {?} url
         * @param {?} data
         * @param {?=} httpConfig
         * @return {?}
         */
            function (url, data, httpConfig) {
                var _this = this;
                var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
                return this._getSanitizedRootUrl(newHttpConfig).pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient
                        .post(rootUrl + url, data)
                        .pipe(operators.mergeMap(function (response) {
                        var /** @type {?} */ dataId = response.uid;
                        return newHttpConfig.useIndexDb
                            ? dataId
                                ? _this._updateIndexDb(newHttpConfig, __assign({}, data, { id: dataId }), 'CREATE').pipe(operators.map(function () { return response; }))
                                : rxjs.of(response)
                            : rxjs.of(response);
                    }))
                        .pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?} data
         * @param {?=} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.put = /**
         * @param {?} url
         * @param {?} data
         * @param {?=} httpConfig
         * @return {?}
         */
            function (url, data, httpConfig) {
                var _this = this;
                var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
                return this._getSanitizedRootUrl(newHttpConfig).pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient.put(rootUrl + url, data).pipe(operators.mergeMap(function (response) {
                        return newHttpConfig.useIndexDb
                            ? _this._updateIndexDb(newHttpConfig, data, 'UPDATE').pipe(operators.map(function () { return response; }))
                            : rxjs.of(response);
                    }), operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?=} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.delete = /**
         * @param {?} url
         * @param {?=} httpConfig
         * @return {?}
         */
            function (url, httpConfig) {
                var _this = this;
                var /** @type {?} */ newHttpConfig = __assign({}, HTTP_CONFIG, httpConfig);
                return this._getSanitizedRootUrl(newHttpConfig).pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient
                        .delete(rootUrl + url)
                        .pipe(operators.mergeMap(function (response) {
                        return newHttpConfig.useIndexDb
                            ? _this._updateIndexDb(newHttpConfig, null, 'DELETE').pipe(operators.map(function () { return response; }))
                            : rxjs.of(response);
                    }))
                        .pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._get = /**
         * @param {?} url
         * @param {?} httpConfig
         * @return {?}
         */
            function (url, httpConfig) {
                var _this = this;
                return this._getSanitizedRootUrl(httpConfig).pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient.get(rootUrl + url).pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} err
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._handleError = /**
         * @param {?} err
         * @return {?}
         */
            function (err) {
                var /** @type {?} */ error = null;
                if (err.error instanceof ErrorEvent) {
                    // A client-side or network error occurred. Handle it accordingly.
                    error = {
                        message: err.error,
                        status: err.status,
                        statusText: err.statusText
                    };
                }
                else {
                    // The backend returned an unsuccessful response code.
                    // The response body may contain clues as to what went wrong,
                    error = {
                        message: err.error instanceof Object
                            ? err.error.message
                            : err.error || err.message,
                        status: err.status,
                        statusText: err.statusText
                    };
                }
                return rxjs.throwError(error);
            };
        /**
         * @param {?} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._getSanitizedRootUrl = /**
         * @param {?} httpConfig
         * @return {?}
         */
            function (httpConfig) {
                return httpConfig.useRootUrl
                    ? this.manifestService.getRootUrl()
                    : this._getApiRootUrl(httpConfig.includeVersionNumber, httpConfig.preferPreviousApiVersion);
            };
        /**
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousVersion
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._getApiRootUrl = /**
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousVersion
         * @return {?}
         */
            function (includeVersionNumber, preferPreviousVersion) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousVersion === void 0) {
                    preferPreviousVersion = false;
                }
                var /** @type {?} */ rootUrlPromise = this.manifestService.getRootUrl().pipe(operators.switchMap(function (rootUrl) {
                    return _this.systemInfoService.getSystemVersion().pipe(operators.map(function (version) {
                        return {
                            rootUrl: rootUrl,
                            version: version - 1 <= 25 ? version + 1 : version
                        };
                    }));
                }));
                return rootUrlPromise.pipe(operators.map(function (urlInfo) {
                    return urlInfo.rootUrl + "api/" + (includeVersionNumber && !preferPreviousVersion
                        ? urlInfo.version + '/'
                        : preferPreviousVersion
                            ? urlInfo.version
                                ? urlInfo.version - 1 + '/'
                                : ''
                            : '');
                }));
            };
        /**
         * @param {?} httpConfig
         * @param {?} requestData
         * @param {?=} action
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._updateIndexDb = /**
         * @param {?} httpConfig
         * @param {?} requestData
         * @param {?=} action
         * @return {?}
         */
            function (httpConfig, requestData, action) {
                if (action === void 0) {
                    action = 'CREATE';
                }
                var /** @type {?} */ indexDbSchema = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.schema
                    : null;
                var /** @type {?} */ arrayKey = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.arrayKey
                    : null;
                var /** @type {?} */ indexDbKey = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.key
                    : null;
                var /** @type {?} */ data = arrayKey ? requestData[arrayKey] : requestData;
                switch (action) {
                    case 'CREATE':
                    case 'UPDATE':
                        return (action === 'CREATE'
                            ? this.indexDbService.post(indexDbSchema, data)
                            : this.indexDbService.put(indexDbSchema, data)).pipe(operators.map(function () { return requestData; }), operators.catchError(function (e) {
                            console.warn('Could not save data into index DB, ERROR: ' + e);
                            return rxjs.of(requestData);
                        }));
                    case 'DELETE':
                        return this.indexDbService.delete(indexDbSchema, indexDbKey).pipe(operators.map(function () { return requestData; }), operators.catchError(function (e) {
                            console.warn('Could not delete data from index DB, ERROR: ' + e);
                            return rxjs.of(requestData);
                        }));
                    default:
                        console.log('No action has been specified');
                        return rxjs.of(requestData);
                }
            };
        /**
         * @param {?} httpConfig
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._fetchFromIndexDb = /**
         * @param {?} httpConfig
         * @return {?}
         */
            function (httpConfig) {
                var /** @type {?} */ indexDbSchema = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.schema
                    : null;
                var /** @type {?} */ indexDbKey = httpConfig.indexDbConfig
                    ? httpConfig.indexDbConfig.key
                    : null;
                return indexDbKey
                    ? this.indexDbService.findOne(indexDbSchema, indexDbKey)
                    : this.indexDbService.findAll(indexDbSchema).pipe(operators.map(function (response) {
                        var /** @type {?} */ arrayKey = httpConfig.indexDbConfig
                            ? httpConfig.indexDbConfig.arrayKey
                            : null;
                        return response.length > 0
                            ? arrayKey
                                ? (_a = {}, _a[arrayKey] = response, _a) : response
                            : null;
                        var _a;
                    }));
            };
        NgxDhis2HttpClientService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        NgxDhis2HttpClientService.ctorParameters = function () {
            return [
                { type: i1.HttpClient },
                { type: ManifestService },
                { type: SystemInfoService },
                { type: IndexDbService }
            ];
        };
        /** @nocollapse */ NgxDhis2HttpClientService.ngInjectableDef = i0.defineInjectable({ factory: function NgxDhis2HttpClientService_Factory() { return new NgxDhis2HttpClientService(i0.inject(i1.HttpClient), i0.inject(ManifestService), i0.inject(SystemInfoService), i0.inject(IndexDbService)); }, token: NgxDhis2HttpClientService, providedIn: "root" });
        return NgxDhis2HttpClientService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    exports.ManifestService = ManifestService;
    exports.SystemInfoService = SystemInfoService;
    exports.NgxDhis2HttpClientService = NgxDhis2HttpClientService;
    exports.IndexDbService = IndexDbService;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWFwcHMtbmd4LWRoaXMyLWh0dHAtY2xpZW50LnVtZC5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vQGlhcHBzL25neC1kaGlzMi1odHRwLWNsaWVudC9saWIvc2VydmljZXMvbWFuaWZlc3Quc2VydmljZS50cyIsbnVsbCwibmc6Ly9AaWFwcHMvbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9zeXN0ZW0taW5mby5zZXJ2aWNlLnRzIiwibmc6Ly9AaWFwcHMvbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9jb25zdGFudHMvaHR0cC1jb25maWcuY29uc3RhbnQudHMiLCJuZzovL0BpYXBwcy9uZ3gtZGhpczItaHR0cC1jbGllbnQvbGliL3NlcnZpY2VzL2luZGV4LWRiLnNlcnZpY2UudHMiLCJuZzovL0BpYXBwcy9uZ3gtZGhpczItaHR0cC1jbGllbnQvbGliL3NlcnZpY2VzL25neC1kaGlzMi1odHRwLWNsaWVudC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBNYW5pZmVzdCB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwLCBjYXRjaEVycm9yLCBtYXAgfSBmcm9tICdyeGpzL2ludGVybmFsL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIE1hbmlmZXN0U2VydmljZSB7XG4gIHByaXZhdGUgX21hbmlmZXN0OiBNYW5pZmVzdDtcbiAgcHJpdmF0ZSBfZGVmYXVsdFJvb3RVcmw6IHN0cmluZztcbiAgcHJpdmF0ZSBfbWFuaWZlc3RMb2FkZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XG4gICAgdGhpcy5fZGVmYXVsdFJvb3RVcmwgPSAnLi4vLi4vLi4vJztcbiAgICB0aGlzLl9tYW5pZmVzdExvYWRlZCA9IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIGdldE1hbmlmZXN0KCk6IE9ic2VydmFibGU8TWFuaWZlc3Q+IHtcbiAgICByZXR1cm4gdGhpcy5fbWFuaWZlc3RMb2FkZWQgPyBvZih0aGlzLl9tYW5pZmVzdCkgOiB0aGlzLmh0dHBDbGllbnQuZ2V0PE1hbmlmZXN0PignbWFuaWZlc3Qud2ViYXBwJykucGlwZShcbiAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmlmZXN0IGZpbGUgY291bGQgbm90IGJlIGxvYWRlZCwgZGVmYXVsdCBvcHRpb25zIGhhdmUgYmVlbiB1c2VkIGluc3RlYWQnKTtcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgfSksXG4gICAgICB0YXAoKG1hbmlmZXN0KSA9PiB7XG4gICAgICAgIHRoaXMuX21hbmlmZXN0ID0gbWFuaWZlc3Q7XG4gICAgICAgIHRoaXMuX21hbmlmZXN0TG9hZGVkID0gdHJ1ZTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSb290VXJsKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TWFuaWZlc3QoKS5waXBlKG1hcCgobWFuaWZlc3Q6IE1hbmlmZXN0KSA9PiB7XG4gICAgICBpZiAoIW1hbmlmZXN0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0Um9vdFVybDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtYW5pZmVzdC5hY3Rpdml0aWVzICYmIG1hbmlmZXN0LmFjdGl2aXRpZXMuZGhpcyAmJiBtYW5pZmVzdC5hY3Rpdml0aWVzLmRoaXMuaHJlZiA/XG4gICAgICAgIG1hbmlmZXN0LmFjdGl2aXRpZXMuZGhpcy5ocmVmIDogdGhpcy5fZGVmYXVsdFJvb3RVcmw7XG4gICAgfSkpO1xuICB9XG59XG4iLCIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxyXG50aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxyXG5MaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxyXG5LSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVEXHJcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXHJcbk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuXHJcblxyXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcclxuYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMClcclxuICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBleHBvcnRzKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdO1xyXG4gICAgaWYgKCFtKSByZXR1cm4gbztcclxuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikgeyBlID0geyBlcnJvcjogZXJyb3IgfTsgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgIXIuZG9uZSAmJiAobSA9IGlbXCJyZXR1cm5cIl0pKSBtLmNhbGwoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogbiA9PT0gXCJyZXR1cm5cIiB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhvKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcclxuICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XHJcbiAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsIFwicmF3XCIsIHsgdmFsdWU6IHJhdyB9KTsgfSBlbHNlIHsgY29va2VkLnJhdyA9IHJhdzsgfVxyXG4gICAgcmV0dXJuIGNvb2tlZDtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIHJlc3VsdFtrXSA9IG1vZFtrXTtcclxuICAgIHJlc3VsdC5kZWZhdWx0ID0gbW9kO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0RGVmYXVsdChtb2QpIHtcclxuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgZGVmYXVsdDogbW9kIH07XHJcbn1cclxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZm9ya0pvaW4sIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNYW5pZmVzdFNlcnZpY2UgfSBmcm9tICcuL21hbmlmZXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvaW50ZXJuYWwvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIFN5c3RlbUluZm9TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBfc3lzdGVtSW5mb0xvYWRlZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfc3lzdGVtSW5mbzogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWFuaWZlc3RTZXJ2aWNlOiBNYW5pZmVzdFNlcnZpY2UsIHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCkge1xuICAgIHRoaXMuX3N5c3RlbUluZm9Mb2FkZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGdldFN5c3RlbUluZm8oKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5fc3lzdGVtSW5mb0xvYWRlZCA/IG9mKHRoaXMuX3N5c3RlbUluZm8pIDpcbiAgICAgIHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKHJvb3RVcmw6IHN0cmluZykgPT4gZm9ya0pvaW4odGhpcy5odHRwQ2xpZW50LmdldChgJHtyb290VXJsfWFwaS9zeXN0ZW0vaW5mb2ApLFxuICAgICAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQoYCR7cm9vdFVybH1hcGkvc3lzdGVtU2V0dGluZ3NgKSkucGlwZShtYXAoKHJlczogYW55W10pID0+IHtcbiAgICAgICAgICByZXR1cm4gey4uLnJlc1swXSwgLi4ucmVzWzFdfTtcbiAgICAgICAgfSksIHRhcCgoc3lzdGVtSW5mbzogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5fc3lzdGVtSW5mbyA9IHN5c3RlbUluZm87XG4gICAgICAgICAgdGhpcy5fc3lzdGVtSW5mb0xvYWRlZCA9IHRydWU7XG4gICAgICAgIH0pKSkpO1xuICB9XG5cbiAgcHVibGljIGdldFN5c3RlbVZlcnNpb24oKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRTeXN0ZW1JbmZvKCkucGlwZShtYXAoKHN5c3RlbUluZm86IGFueSkgPT4ge1xuICAgICAgaWYgKCFzeXN0ZW1JbmZvKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3BsaXRlZFZlcnNpb24gPSBzeXN0ZW1JbmZvLnZlcnNpb24gPyBzeXN0ZW1JbmZvLnZlcnNpb24uc3BsaXQoJy4nKSA6IFtdO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KHNwbGl0ZWRWZXJzaW9uWzFdLCAxMCkgfHwgMDtcbiAgICB9KSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IEh0dHBDb25maWcgfSBmcm9tICcuLi9tb2RlbHMvaHR0cC1jb25maWcubW9kZWwnO1xuXG5leHBvcnQgY29uc3QgSFRUUF9DT05GSUc6IEh0dHBDb25maWcgPSB7XG4gIGluY2x1ZGVWZXJzaW9uTnVtYmVyOiBmYWxzZSxcbiAgcHJlZmVyUHJldmlvdXNBcGlWZXJzaW9uOiBmYWxzZSxcbiAgdXNlUm9vdFVybDogZmFsc2UsXG4gIHVzZUluZGV4RGI6IGZhbHNlLFxuICBpc0V4dGVybmFsTGluazogZmFsc2Vcbn07XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBzd2l0Y2hNYXAsIG1lcmdlTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgSW5kZXhEYlNlcnZpY2Uge1xuICBwcml2YXRlIF9pbmRleGVkREI6IGFueTtcbiAgcHJpdmF0ZSBfZGJOYW1lOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5faW5kZXhlZERCID0gaW5kZXhlZERCO1xuICAgIHRoaXMuX2RiTmFtZSA9ICdkYic7IC8vIGJ5IGRlZmF1bHRcbiAgfVxuXG4gIHNldE5hbWUoZGJOYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoZGJOYW1lKSB7XG4gICAgICB0aGlzLl9kYk5hbWUgPSBkYk5hbWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIHVwZGF0ZSBleGlzdGluZyBkYXRhIGluIHRoZSBkYlxuICAgKi9cbiAgcHV0KHNjaGVtYTogYW55LCBkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jcmVhdGUoc2NoZW1hKVxuICAgICAgICAucGlwZShzd2l0Y2hNYXAoKCkgPT4gdGhpcy5vcGVuKCkpKVxuICAgICAgICAuc3Vic2NyaWJlKChkYjogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihzY2hlbWEubmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc2NoZW1hLm5hbWUpO1xuXG4gICAgICAgICAgaWYgKF8uaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgXy5lYWNoKGRhdGEsIGRhdGFJdGVtID0+IHtcbiAgICAgICAgICAgICAgc3RvcmUucHV0KGRhdGFJdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdG9yZS5wdXQoZGF0YSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGRiLm9uZXJyb3IgPSAoZXJyb3JFdmVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3JFdmVudC50YXJnZXQuZXJyb3JDb2RlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBhZGQgbmV3IGRhdGEgaW4gdGhlIGRiXG4gICAqL1xuICBwb3N0KHNjaGVtYTogYW55LCBkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jcmVhdGUoc2NoZW1hKVxuICAgICAgICAucGlwZShtZXJnZU1hcCgoKSA9PiB0aGlzLm9wZW4oKSkpXG4gICAgICAgIC5zdWJzY3JpYmUoKGRiOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKHNjaGVtYS5uYW1lLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzY2hlbWEubmFtZSk7XG5cbiAgICAgICAgICAvLyBDaGVjayBpZiBkYXRhIGlzIGFycmF5IG9yIGFuIG9iamVjdFxuICAgICAgICAgIGlmIChfLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgIF8uZWFjaChkYXRhLCBkYXRhSXRlbSA9PiB7XG4gICAgICAgICAgICAgIHN0b3JlLmFkZChkYXRhSXRlbSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RvcmUuYWRkKGRhdGEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkYi5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhKTtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGdldCB2YWx1ZSBmb3IgYSBwYXJ0aWN1bGFyIGtleSBmcm9tIHRoZSB0YWJsZVxuICAgKi9cbiAgZmluZE9uZShzY2hlbWE6IGFueSwga2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueVtdPiB7XG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZShzY2hlbWEpXG4gICAgICAgIC5waXBlKG1lcmdlTWFwKCgpID0+IHRoaXMub3BlbigpKSlcbiAgICAgICAgLnN1YnNjcmliZSgoZGI6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oc2NoZW1hLm5hbWUsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHNjaGVtYS5uYW1lKTtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0KGtleSk7XG4gICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBzdWNjZXNzRXZlbnQgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChzdWNjZXNzRXZlbnQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGRiLm9uZXJyb3IgPSAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZmluZCBhbGwgdmFsdWVzIGZvciBhIHBhcnRpY3VsYXIgdGFibGUgaW4gdGhlIGRiXG4gICAqL1xuICBmaW5kQWxsKHNjaGVtYTogYW55KTogT2JzZXJ2YWJsZTxhbnlbXT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jcmVhdGUoc2NoZW1hKVxuICAgICAgICAucGlwZShzd2l0Y2hNYXAoKCkgPT4gdGhpcy5vcGVuKCkpKVxuICAgICAgICAuc3Vic2NyaWJlKChkYjogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihzY2hlbWEubmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc2NoZW1hLm5hbWUpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlSW5kZXggPSBzdG9yZS5pbmRleChzY2hlbWEua2V5UGF0aCk7XG4gICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHN0b3JlSW5kZXgub3BlbkN1cnNvcigpO1xuICAgICAgICAgIGxldCByZXN1bHRzOiBhbnlbXSA9IFtdO1xuXG4gICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBzdWNjZXNzRXZlbnQgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gc3VjY2Vzc0V2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICBpZiAoY3Vyc29yKSB7XG4gICAgICAgICAgICAgIHJlc3VsdHMgPSBbLi4ucmVzdWx0cywgY3Vyc29yLnZhbHVlXTtcbiAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHJlc3VsdHMpO1xuICAgICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgZGIub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGRhdGEgZnJvbSB0aGUgZGJcbiAgICovXG4gIGRlbGV0ZShzY2hlbWE6IGFueSwga2V5OiBzdHJpbmcgfCBzdHJpbmdbXSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICB0aGlzLm9wZW4oKS5zdWJzY3JpYmUoKGRiOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHNjaGVtYS5uYW1lKSkge1xuICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oc2NoZW1hLm5hbWUsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHNjaGVtYS5uYW1lKTtcblxuICAgICAgICAgIGlmIChfLmlzQXJyYXkoa2V5KSkge1xuICAgICAgICAgICAgXy5lYWNoKGtleSwga2V5SXRlbSA9PiB7XG4gICAgICAgICAgICAgIHN0b3JlLmRlbGV0ZShrZXlJdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChrZXkpO1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkYi5vbmVycm9yID0gKGVycm9yRXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yRXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc2NoZW1hL3RhYmxlXG4gICAqL1xuICBjcmVhdGUoc2NoZW1hOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IGFueSkgPT4ge1xuICAgICAgdGhpcy5vcGVuKCkuc3Vic2NyaWJlKChyZXF1ZXN0UmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFyZXF1ZXN0UmVzdWx0Lm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoc2NoZW1hLm5hbWUpKSB7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogQ2xvc2UgZGF0YWJhc2UgdG8gYWxsb3cgb3BlbmluZyB3aXRoIG5ldyB2ZXJzaW9uXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmVxdWVzdFJlc3VsdC5jbG9zZSgpO1xuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogU2V0IGEgbmV3IGNvbm5lY3Rpb24gd2l0aCBuZXcgdmVyc2lvbiB0byBhbGxvd3MgY3JlYXRpbmcgc2NoZW1hXG4gICAgICAgICAgICovXG4gICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuX2luZGV4ZWREQi5vcGVuKFxuICAgICAgICAgICAgdGhpcy5fZGJOYW1lLFxuICAgICAgICAgICAgcmVxdWVzdFJlc3VsdC52ZXJzaW9uICsgMVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzY2hlbWEubmFtZSkpIHtcbiAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAqIENyZWF0ZSBjb3JyZXNwb25kaW5nIHNjaGVtYVxuICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShzY2hlbWEubmFtZSwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IHNjaGVtYS5rZXlQYXRoXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChzY2hlbWEua2V5UGF0aCwgc2NoZW1hLmtleVBhdGgsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6IHRydWVcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAqIENyZWF0ZSBpbmRleGVzIGZvciBzY2hlbWEgaWYgc3VwcGxpZWRcbiAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGlmIChzY2hlbWEuaW5kZXhlcykge1xuICAgICAgICAgICAgICAgIF8uZWFjaChzY2hlbWEuaW5kZXhlcywgKHNjaGVtYUluZGV4OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KHNjaGVtYUluZGV4LCBzY2hlbWFJbmRleCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICogQWRkIGRhdGEgaWYgc3VwcGxpZWRcbiAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGlmIChzY2hlbWEuZGF0YSkge1xuICAgICAgICAgICAgICAgIF8uZWFjaChzY2hlbWEuZGF0YSwgKGRhdGFJdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHN0b3JlLnB1dChkYXRhSXRlbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCgnZG9uZScpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZXJyb3JFdmVudCA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvckV2ZW50LnRhcmdldC5lcnJvckNvZGUpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IHN1Y2Nlc3NFdmVudCA9PiB7XG4gICAgICAgICAgICBzdWNjZXNzRXZlbnQudGFyZ2V0LnJlc3VsdC5jbG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCgnZG9uZScpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQoJ2RvbmUnKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgdGhlIHdob2xlIGRhdGFiYXNlXG4gICAqL1xuICBjbGVhcigpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IGFueSkgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuX2luZGV4ZWREQi5kZWxldGVEYXRhYmFzZSh0aGlzLl9kYk5hbWUpO1xuXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgb2JzZXJ2ZXIubmV4dCgnZG9uZScpO1xuICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGVycm9yRXZlbnQgPT4ge1xuICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvckV2ZW50LnRhcmdldC5lcnJvckNvZGUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25ibG9ja2VkID0gYmxvY2tFdmVudCA9PiB7XG4gICAgICAgIG9ic2VydmVyLmVycm9yKGJsb2NrRXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBvcGVuKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5faW5kZXhlZERCLm9wZW4odGhpcy5fZGJOYW1lKTtcblxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBzdWNjZXNzRXZlbnQgPT4ge1xuICAgICAgICBvYnNlcnZlci5uZXh0KHN1Y2Nlc3NFdmVudC50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBlcnJvckV2ZW50ID0+XG4gICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yRXZlbnQudGFyZ2V0LmVycm9yQ29kZSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgTWFuaWZlc3RTZXJ2aWNlIH0gZnJvbSAnLi9tYW5pZmVzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFN5c3RlbUluZm9TZXJ2aWNlIH0gZnJvbSAnLi9zeXN0ZW0taW5mby5zZXJ2aWNlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIHRocm93RXJyb3IsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBjYXRjaEVycm9yLFxuICBtYXAsXG4gIG1lcmdlTWFwLFxuICBzd2l0Y2hNYXAsXG4gIHRhcFxufSBmcm9tICdyeGpzL2ludGVybmFsL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBIdHRwQ29uZmlnLCBJbmRleERiU2NoZW1hIH0gZnJvbSAnLi4vbW9kZWxzL2h0dHAtY29uZmlnLm1vZGVsJztcbmltcG9ydCB7IEhUVFBfQ09ORklHIH0gZnJvbSAnLi4vY29uc3RhbnRzL2h0dHAtY29uZmlnLmNvbnN0YW50JztcbmltcG9ydCB7IEluZGV4RGJTZXJ2aWNlIH0gZnJvbSAnLi9pbmRleC1kYi5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBOZ3hEaGlzMkh0dHBDbGllbnRTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbWFuaWZlc3RTZXJ2aWNlOiBNYW5pZmVzdFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzeXN0ZW1JbmZvU2VydmljZTogU3lzdGVtSW5mb1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbmRleERiU2VydmljZTogSW5kZXhEYlNlcnZpY2VcbiAgKSB7fVxuXG4gIGdldCh1cmw6IHN0cmluZywgaHR0cENvbmZpZz86IEh0dHBDb25maWcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IG5ld0h0dHBDb25maWcgPSB7IC4uLkhUVFBfQ09ORklHLCAuLi5odHRwQ29uZmlnIH07XG5cbiAgICAvLyBNYWtlIGEgY2FsbCBkaXJlY3RseSBmcm9tIHVybCBpZiBpcyBleHRlcm5hbCBvbmVcbiAgICBpZiAobmV3SHR0cENvbmZpZy5pc0V4dGVybmFsTGluaykge1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodXJsKTtcbiAgICB9XG5cbiAgICAvLyBsb2FkIGZyb20gaW5kZXggZGJcbiAgICBpZiAobmV3SHR0cENvbmZpZy51c2VJbmRleERiKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZmV0Y2hGcm9tSW5kZXhEYihuZXdIdHRwQ29uZmlnKS5waXBlKFxuICAgICAgICBtZXJnZU1hcCgoaW5kZXhEYlJlc3BvbnNlOiBhbnkpID0+XG4gICAgICAgICAgaW5kZXhEYlJlc3BvbnNlXG4gICAgICAgICAgICA/IG9mKGluZGV4RGJSZXNwb25zZSlcbiAgICAgICAgICAgIDogdGhpcy5fZ2V0KHVybCwgbmV3SHR0cENvbmZpZykucGlwZShcbiAgICAgICAgICAgICAgICBtZXJnZU1hcCgocmVzcG9uc2U6IGFueSkgPT5cbiAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUluZGV4RGIobmV3SHR0cENvbmZpZywgcmVzcG9uc2UpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX2dldCh1cmwsIG5ld0h0dHBDb25maWcpO1xuICB9XG5cbiAgcG9zdCh1cmw6IHN0cmluZywgZGF0YTogYW55LCBodHRwQ29uZmlnPzogSHR0cENvbmZpZykge1xuICAgIGNvbnN0IG5ld0h0dHBDb25maWcgPSB7IC4uLkhUVFBfQ09ORklHLCAuLi5odHRwQ29uZmlnIH07XG5cbiAgICByZXR1cm4gdGhpcy5fZ2V0U2FuaXRpemVkUm9vdFVybChuZXdIdHRwQ29uZmlnKS5waXBlKFxuICAgICAgbWVyZ2VNYXAocm9vdFVybCA9PlxuICAgICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAucG9zdChyb290VXJsICsgdXJsLCBkYXRhKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgbWVyZ2VNYXAoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgZGF0YUlkID0gcmVzcG9uc2UudWlkO1xuICAgICAgICAgICAgICByZXR1cm4gbmV3SHR0cENvbmZpZy51c2VJbmRleERiXG4gICAgICAgICAgICAgICAgPyBkYXRhSWRcbiAgICAgICAgICAgICAgICAgID8gdGhpcy5fdXBkYXRlSW5kZXhEYihcbiAgICAgICAgICAgICAgICAgICAgICBuZXdIdHRwQ29uZmlnLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZGF0YUlkXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAnQ1JFQVRFJ1xuICAgICAgICAgICAgICAgICAgICApLnBpcGUobWFwKCgpID0+IHJlc3BvbnNlKSlcbiAgICAgICAgICAgICAgICAgIDogb2YocmVzcG9uc2UpXG4gICAgICAgICAgICAgICAgOiBvZihyZXNwb25zZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKSlcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICBwdXQodXJsOiBzdHJpbmcsIGRhdGE6IGFueSwgaHR0cENvbmZpZz86IEh0dHBDb25maWcpIHtcbiAgICBjb25zdCBuZXdIdHRwQ29uZmlnID0geyAuLi5IVFRQX0NPTkZJRywgLi4uaHR0cENvbmZpZyB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX2dldFNhbml0aXplZFJvb3RVcmwobmV3SHR0cENvbmZpZykucGlwZShcbiAgICAgIG1lcmdlTWFwKHJvb3RVcmwgPT5cbiAgICAgICAgdGhpcy5odHRwQ2xpZW50LnB1dChyb290VXJsICsgdXJsLCBkYXRhKS5waXBlKFxuICAgICAgICAgIG1lcmdlTWFwKChyZXNwb25zZTogYW55KSA9PlxuICAgICAgICAgICAgbmV3SHR0cENvbmZpZy51c2VJbmRleERiXG4gICAgICAgICAgICAgID8gdGhpcy5fdXBkYXRlSW5kZXhEYihuZXdIdHRwQ29uZmlnLCBkYXRhLCAnVVBEQVRFJykucGlwZShcbiAgICAgICAgICAgICAgICAgIG1hcCgoKSA9PiByZXNwb25zZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIDogb2YocmVzcG9uc2UpXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgY2F0Y2hFcnJvcih0aGlzLl9oYW5kbGVFcnJvcilcbiAgICApO1xuICB9XG5cbiAgZGVsZXRlKHVybDogc3RyaW5nLCBodHRwQ29uZmlnPzogSHR0cENvbmZpZykge1xuICAgIGNvbnN0IG5ld0h0dHBDb25maWcgPSB7IC4uLkhUVFBfQ09ORklHLCAuLi5odHRwQ29uZmlnIH07XG5cbiAgICByZXR1cm4gdGhpcy5fZ2V0U2FuaXRpemVkUm9vdFVybChuZXdIdHRwQ29uZmlnKS5waXBlKFxuICAgICAgbWVyZ2VNYXAocm9vdFVybCA9PlxuICAgICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAuZGVsZXRlKHJvb3RVcmwgKyB1cmwpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBtZXJnZU1hcCgocmVzcG9uc2U6IGFueSkgPT5cbiAgICAgICAgICAgICAgbmV3SHR0cENvbmZpZy51c2VJbmRleERiXG4gICAgICAgICAgICAgICAgPyB0aGlzLl91cGRhdGVJbmRleERiKG5ld0h0dHBDb25maWcsIG51bGwsICdERUxFVEUnKS5waXBlKFxuICAgICAgICAgICAgICAgICAgICBtYXAoKCkgPT4gcmVzcG9uc2UpXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgOiBvZihyZXNwb25zZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcih0aGlzLl9oYW5kbGVFcnJvcikpXG4gICAgICApLFxuICAgICAgY2F0Y2hFcnJvcih0aGlzLl9oYW5kbGVFcnJvcilcbiAgICApO1xuICB9XG5cbiAgLy8gcHJpdmF0ZSBtZXRob2RzXG5cbiAgcHJpdmF0ZSBfZ2V0KHVybCwgaHR0cENvbmZpZzogSHR0cENvbmZpZykge1xuICAgIHJldHVybiB0aGlzLl9nZXRTYW5pdGl6ZWRSb290VXJsKGh0dHBDb25maWcpLnBpcGUoXG4gICAgICBtZXJnZU1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArIHVybCkucGlwZShjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKSlcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cbiAgcHJpdmF0ZSBfaGFuZGxlRXJyb3IoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkge1xuICAgIGxldCBlcnJvciA9IG51bGw7XG4gICAgaWYgKGVyci5lcnJvciBpbnN0YW5jZW9mIEVycm9yRXZlbnQpIHtcbiAgICAgIC8vIEEgY2xpZW50LXNpZGUgb3IgbmV0d29yayBlcnJvciBvY2N1cnJlZC4gSGFuZGxlIGl0IGFjY29yZGluZ2x5LlxuICAgICAgZXJyb3IgPSB7XG4gICAgICAgIG1lc3NhZ2U6IGVyci5lcnJvcixcbiAgICAgICAgc3RhdHVzOiBlcnIuc3RhdHVzLFxuICAgICAgICBzdGF0dXNUZXh0OiBlcnIuc3RhdHVzVGV4dFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhlIGJhY2tlbmQgcmV0dXJuZWQgYW4gdW5zdWNjZXNzZnVsIHJlc3BvbnNlIGNvZGUuXG4gICAgICAvLyBUaGUgcmVzcG9uc2UgYm9keSBtYXkgY29udGFpbiBjbHVlcyBhcyB0byB3aGF0IHdlbnQgd3JvbmcsXG4gICAgICBlcnJvciA9IHtcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICBlcnIuZXJyb3IgaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgICAgICAgID8gZXJyLmVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIDogZXJyLmVycm9yIHx8IGVyci5tZXNzYWdlLFxuICAgICAgICBzdGF0dXM6IGVyci5zdGF0dXMsXG4gICAgICAgIHN0YXR1c1RleHQ6IGVyci5zdGF0dXNUZXh0XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvcik7XG4gIH1cblxuICBwcml2YXRlIF9nZXRTYW5pdGl6ZWRSb290VXJsKGh0dHBDb25maWc6IEh0dHBDb25maWcpIHtcbiAgICByZXR1cm4gaHR0cENvbmZpZy51c2VSb290VXJsXG4gICAgICA/IHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKVxuICAgICAgOiB0aGlzLl9nZXRBcGlSb290VXJsKFxuICAgICAgICAgIGh0dHBDb25maWcuaW5jbHVkZVZlcnNpb25OdW1iZXIsXG4gICAgICAgICAgaHR0cENvbmZpZy5wcmVmZXJQcmV2aW91c0FwaVZlcnNpb25cbiAgICAgICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgX2dldEFwaVJvb3RVcmwoXG4gICAgaW5jbHVkZVZlcnNpb25OdW1iZXI6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBwcmVmZXJQcmV2aW91c1ZlcnNpb246IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICBjb25zdCByb290VXJsUHJvbWlzZSA9IHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKS5waXBlKFxuICAgICAgc3dpdGNoTWFwKHJvb3RVcmwgPT5cbiAgICAgICAgdGhpcy5zeXN0ZW1JbmZvU2VydmljZS5nZXRTeXN0ZW1WZXJzaW9uKCkucGlwZShcbiAgICAgICAgICBtYXAoKHZlcnNpb246IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgcm9vdFVybCxcbiAgICAgICAgICAgICAgdmVyc2lvbjogdmVyc2lvbiAtIDEgPD0gMjUgPyB2ZXJzaW9uICsgMSA6IHZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIHJvb3RVcmxQcm9taXNlLnBpcGUoXG4gICAgICBtYXAoXG4gICAgICAgICh1cmxJbmZvOiB7IHJvb3RVcmw6IHN0cmluZzsgdmVyc2lvbjogbnVtYmVyIH0pID0+XG4gICAgICAgICAgYCR7dXJsSW5mby5yb290VXJsfWFwaS8ke1xuICAgICAgICAgICAgaW5jbHVkZVZlcnNpb25OdW1iZXIgJiYgIXByZWZlclByZXZpb3VzVmVyc2lvblxuICAgICAgICAgICAgICA/IHVybEluZm8udmVyc2lvbiArICcvJ1xuICAgICAgICAgICAgICA6IHByZWZlclByZXZpb3VzVmVyc2lvblxuICAgICAgICAgICAgICA/IHVybEluZm8udmVyc2lvblxuICAgICAgICAgICAgICAgID8gdXJsSW5mby52ZXJzaW9uIC0gMSArICcvJ1xuICAgICAgICAgICAgICAgIDogJydcbiAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgIH1gXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZUluZGV4RGIoXG4gICAgaHR0cENvbmZpZzogSHR0cENvbmZpZyxcbiAgICByZXF1ZXN0RGF0YTogYW55LFxuICAgIGFjdGlvbjogc3RyaW5nID0gJ0NSRUFURSdcbiAgKSB7XG4gICAgY29uc3QgaW5kZXhEYlNjaGVtYTogSW5kZXhEYlNjaGVtYSA9IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZ1xuICAgICAgPyBodHRwQ29uZmlnLmluZGV4RGJDb25maWcuc2NoZW1hXG4gICAgICA6IG51bGw7XG5cbiAgICBjb25zdCBhcnJheUtleSA9IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZ1xuICAgICAgPyBodHRwQ29uZmlnLmluZGV4RGJDb25maWcuYXJyYXlLZXlcbiAgICAgIDogbnVsbDtcblxuICAgIGNvbnN0IGluZGV4RGJLZXkgPSBodHRwQ29uZmlnLmluZGV4RGJDb25maWdcbiAgICAgID8gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnLmtleVxuICAgICAgOiBudWxsO1xuXG4gICAgY29uc3QgZGF0YSA9IGFycmF5S2V5ID8gcmVxdWVzdERhdGFbYXJyYXlLZXldIDogcmVxdWVzdERhdGE7XG5cbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSAnQ1JFQVRFJzpcbiAgICAgIGNhc2UgJ1VQREFURSc6XG4gICAgICAgIHJldHVybiAoYWN0aW9uID09PSAnQ1JFQVRFJ1xuICAgICAgICAgID8gdGhpcy5pbmRleERiU2VydmljZS5wb3N0KGluZGV4RGJTY2hlbWEsIGRhdGEpXG4gICAgICAgICAgOiB0aGlzLmluZGV4RGJTZXJ2aWNlLnB1dChpbmRleERiU2NoZW1hLCBkYXRhKVxuICAgICAgICApLnBpcGUoXG4gICAgICAgICAgbWFwKCgpID0+IHJlcXVlc3REYXRhKSxcbiAgICAgICAgICBjYXRjaEVycm9yKGUgPT4ge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3Qgc2F2ZSBkYXRhIGludG8gaW5kZXggREIsIEVSUk9SOiAnICsgZSk7XG4gICAgICAgICAgICByZXR1cm4gb2YocmVxdWVzdERhdGEpO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICBjYXNlICdERUxFVEUnOlxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleERiU2VydmljZS5kZWxldGUoaW5kZXhEYlNjaGVtYSwgaW5kZXhEYktleSkucGlwZShcbiAgICAgICAgICBtYXAoKCkgPT4gcmVxdWVzdERhdGEpLFxuICAgICAgICAgIGNhdGNoRXJyb3IoZSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBkZWxldGUgZGF0YSBmcm9tIGluZGV4IERCLCBFUlJPUjogJyArIGUpO1xuICAgICAgICAgICAgcmV0dXJuIG9mKHJlcXVlc3REYXRhKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5sb2coJ05vIGFjdGlvbiBoYXMgYmVlbiBzcGVjaWZpZWQnKTtcbiAgICAgICAgcmV0dXJuIG9mKHJlcXVlc3REYXRhKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9mZXRjaEZyb21JbmRleERiKGh0dHBDb25maWc6IEh0dHBDb25maWcpIHtcbiAgICBjb25zdCBpbmRleERiU2NoZW1hOiBJbmRleERiU2NoZW1hID0gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnXG4gICAgICA/IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZy5zY2hlbWFcbiAgICAgIDogbnVsbDtcblxuICAgIGNvbnN0IGluZGV4RGJLZXkgPSBodHRwQ29uZmlnLmluZGV4RGJDb25maWdcbiAgICAgID8gaHR0cENvbmZpZy5pbmRleERiQ29uZmlnLmtleVxuICAgICAgOiBudWxsO1xuXG4gICAgcmV0dXJuIGluZGV4RGJLZXlcbiAgICAgID8gdGhpcy5pbmRleERiU2VydmljZS5maW5kT25lKGluZGV4RGJTY2hlbWEsIGluZGV4RGJLZXkpXG4gICAgICA6IHRoaXMuaW5kZXhEYlNlcnZpY2UuZmluZEFsbChpbmRleERiU2NoZW1hKS5waXBlKFxuICAgICAgICAgIG1hcChyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhcnJheUtleSA9IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZ1xuICAgICAgICAgICAgICA/IGh0dHBDb25maWcuaW5kZXhEYkNvbmZpZy5hcnJheUtleVxuICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UubGVuZ3RoID4gMFxuICAgICAgICAgICAgICA/IGFycmF5S2V5XG4gICAgICAgICAgICAgICAgPyB7IFthcnJheUtleV06IHJlc3BvbnNlIH1cbiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlXG4gICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsib2YiLCJjYXRjaEVycm9yIiwidGFwIiwibWFwIiwiSW5qZWN0YWJsZSIsIkh0dHBDbGllbnQiLCJzd2l0Y2hNYXAiLCJmb3JrSm9pbiIsIk9ic2VydmFibGUiLCJfLmlzQXJyYXkiLCJfLmVhY2giLCJtZXJnZU1hcCIsInRocm93RXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtRQVlFLHlCQUFvQixVQUFzQjtZQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1lBQ3hDLElBQUksQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDO1lBQ25DLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1NBQzlC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
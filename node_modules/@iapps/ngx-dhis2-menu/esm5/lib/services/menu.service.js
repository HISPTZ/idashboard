/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import * as fromConstants from '../constants';
import { BehaviorSubject, Observable, forkJoin } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
var MenuService = /** @class */ (function () {
    function MenuService(httpClient) {
        this.httpClient = httpClient;
        this._menuModules$ = new BehaviorSubject([]);
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getSystemSettings = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            forkJoin(_this.httpClient.get(rootUrl + 'api/systemSettings.json'), _this.httpClient.get(rootUrl + 'api/system/info.json')).subscribe(function (settings) {
                observer.next(tslib_1.__assign({}, settings[0], settings[1]));
                observer.complete();
            }, function () { return observer.error(null); });
        });
    };
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getMenuModules = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.httpClient.get(rootUrl + 'dhis-web-commons/menu/getModules.action').subscribe(function (menuModuleResult) {
                var /** @type {?} */ sanitizedMenu = _this._sanitizeMenuItems(menuModuleResult.modules, rootUrl);
                _this._menuModules$.next(sanitizedMenu);
                observer.next(sanitizedMenu);
                observer.complete();
            }, function () {
                observer.next(null);
                observer.complete();
            });
        });
    };
    /**
     * @return {?}
     */
    MenuService.prototype.getSanitizedMenus = /**
     * @return {?}
     */
    function () {
        return this._menuModules$.asObservable();
    };
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getUserInfo = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.httpClient.get(rootUrl + 'api/me.json').subscribe(function (userInfo) {
                observer.next(userInfo);
                observer.complete();
            }, function () {
                observer.next(null);
                observer.complete();
            });
        });
    };
    /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype._sanitizeMenuItems = /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    function (menuItems, rootUrl) {
        var /** @type {?} */ sanitizedMenuItems = menuItems.map(function (item) {
            var /** @type {?} */ newItem = tslib_1.__assign({}, item);
            if (!newItem.hasOwnProperty('displayName') ||
                newItem.displayName === '') {
                newItem.displayName = newItem.name;
            }
            if (newItem.defaultAction.indexOf('http') === -1) {
                newItem.defaultAction = '../../' + newItem.defaultAction;
            }
            if (newItem.icon.indexOf('http') === -1) {
                newItem.icon = '../../' + newItem.icon;
            }
            newItem.onlyShowOnSearch = false;
            return newItem;
        });
        var /** @type {?} */ predefinedMenuItems = fromConstants.PREDEFINED_MENU_ITEMS.map(function (item) {
            var /** @type {?} */ newItem = tslib_1.__assign({}, item);
            if (newItem.defaultAction) {
                newItem.defaultAction = rootUrl + newItem.defaultAction;
            }
            if (newItem.icon) {
                newItem.icon = rootUrl + newItem.icon;
            }
            return newItem;
        });
        return tslib_1.__spread(sanitizedMenuItems, predefinedMenuItems);
    };
    MenuService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    MenuService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ MenuService.ngInjectableDef = i0.defineInjectable({ factory: function MenuService_Factory() { return new MenuService(i0.inject(i1.HttpClient)); }, token: MenuService, providedIn: "root" });
    return MenuService;
}());
export { MenuService };
function MenuService_tsickle_Closure_declarations() {
    /** @type {?} */
    MenuService.prototype._menuModules$;
    /** @type {?} */
    MenuService.prototype.httpClient;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGlhcHBzL25neC1kaGlzMi1tZW51LyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL21lbnUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sS0FBSyxhQUFhLE1BQU0sY0FBYyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztJQU0zRCxxQkFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTs2QkFGTSxJQUFJLGVBQWUsQ0FBUSxFQUFFLENBQUM7S0FHN0U7Ozs7O0lBRUQsdUNBQWlCOzs7O0lBQWpCLFVBQWtCLE9BQWU7UUFBakMsaUJBV0M7UUFWQyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFBLFFBQVE7WUFDL0IsUUFBUSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxFQUMvRCxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDaEUsVUFBQyxRQUFlO2dCQUNkLFFBQVEsQ0FBQyxJQUFJLHNCQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztnQkFDaEQsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3JCLEVBQ0QsY0FBTSxPQUFBLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQXBCLENBQW9CLENBQzNCLENBQUM7U0FDSCxDQUFDLENBQUM7S0FDSjs7Ozs7SUFFRCxvQ0FBYzs7OztJQUFkLFVB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YUFBYSxDQUFDO2FBQ3pEO1lBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7YUFDdkM7WUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDO1NBQ2hCLENBQ0YsQ0FBQztRQUNGLE1BQU0sa0JBQUssa0JBQWtCLEVBQUssbUJBQW1CLEVBQUU7OztnQkEvRjFELFVBQVUsU0FBQyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUM7Ozs7Z0JBTHZCLFVBQVU7OztzQkFBbkI7O1NBTWEsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBmcm9tQ29uc3RhbnRzIGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIGZvcmtKb2luIH0gZnJvbSAncnhqcyc7XG5cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIE1lbnVTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBfbWVudU1vZHVsZXMkOiBCZWhhdmlvclN1YmplY3Q8YW55W10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnlbXT4oW10pO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCkge1xuICB9XG5cbiAgZ2V0U3lzdGVtU2V0dGluZ3Mocm9vdFVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgZm9ya0pvaW4odGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgJ2FwaS9zeXN0ZW1TZXR0aW5ncy5qc29uJyksXG4gICAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArICdhcGkvc3lzdGVtL2luZm8uanNvbicpKS5zdWJzY3JpYmUoXG4gICAgICAgIChzZXR0aW5nczogYW55W10pID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHsuLi5zZXR0aW5nc1swXSwgLi4uc2V0dGluZ3NbMV19KTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9LFxuICAgICAgICAoKSA9PiBvYnNlcnZlci5lcnJvcihudWxsKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldE1lbnVNb2R1bGVzKHJvb3RVcmw6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcbiAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArICdkaGlzLXdlYi1jb21tb25zL21lbnUvZ2V0TW9kdWxlcy5hY3Rpb24nKS5zdWJzY3JpYmUoXG4gICAgICAgIChtZW51TW9kdWxlUmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCBzYW5pdGl6ZWRNZW51ID0gdGhpcy5fc2FuaXRpemVNZW51SXRlbXMobWVudU1vZHVsZVJlc3VsdC5tb2R1bGVzLCByb290VXJsKTtcbiAgICAgICAgICB0aGlzLl9tZW51TW9kdWxlcyQubmV4dChzYW5pdGl6ZWRNZW51KTtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KFxuICAgICAgICAgICAgc2FuaXRpemVkTWVudVxuICAgICAgICAgICk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQobnVsbCk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNhbml0aXplZE1lbnVzKCkge1xuICAgIHJldHVybiB0aGlzLl9tZW51TW9kdWxlcyQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBnZXRVc2VySW5mbyhyb290VXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZShvYnNlcnZlciA9PiB7XG4gICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnYXBpL21lLmpzb24nKS5zdWJzY3JpYmUoXG4gICAgICAgICh1c2VySW5mbzogYW55KSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCh1c2VySW5mbyk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQobnVsbCk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3Nhbml0aXplTWVudUl0ZW1zKG1lbnVJdGVtczogYW55W10sIHJvb3RVcmw6IHN0cmluZyk6IGFueSB7XG4gICAgY29uc3Qgc2FuaXRpemVkTWVudUl0ZW1zID0gbWVudUl0ZW1zLm1hcCgoaXRlbTogYW55KSA9PiB7XG4gICAgICBjb25zdCBuZXdJdGVtOiBhbnkgPSB7Li4uaXRlbX07XG4gICAgICBpZiAoXG4gICAgICAgICFuZXdJdGVtLmhhc093blByb3BlcnR5KCdkaXNwbGF5TmFtZScpIHx8XG4gICAgICAgIG5ld0l0ZW0uZGlzcGxheU5hbWUgPT09ICcnXG4gICAgICApIHtcbiAgICAgICAgbmV3SXRlbS5kaXNwbGF5TmFtZSA9IG5ld0l0ZW0ubmFtZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld0l0ZW0uZGVmYXVsdEFjdGlvbi5pbmRleE9mKCdodHRwJykgPT09IC0xKSB7XG4gICAgICAgIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbiA9ICcuLi8uLi8nICsgbmV3SXRlbS5kZWZhdWx0QWN0aW9uO1xuICAgICAgfVxuXG4gICAgICBpZiAobmV3SXRlbS5pY29uLmluZGV4T2YoJ2h0dHAnKSA9PT0gLTEpIHtcbiAgICAgICAgbmV3SXRlbS5pY29uID0gJy4uLy4uLycgKyBuZXdJdGVtLmljb247XG4gICAgICB9XG5cbiAgICAgIG5ld0l0ZW0ub25seVNob3dPblNlYXJjaCA9IGZhbHNlO1xuXG4gICAgICByZXR1cm4gbmV3SXRlbTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHByZWRlZmluZWRNZW51SXRlbXMgPSBmcm9tQ29uc3RhbnRzLlBSRURFRklORURfTUVOVV9JVEVNUy5tYXAoXG4gICAgICAoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0l0ZW06IGFueSA9IHsuLi5pdGVtfTtcblxuICAgICAgICBpZiAobmV3SXRlbS5kZWZhdWx0QWN0aW9uKSB7XG4gICAgICAgICAgbmV3SXRlbS5kZWZhdWx0QWN0aW9uID0gcm9vdFVybCArIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdJdGVtLmljb24pIHtcbiAgICAgICAgICBuZXdJdGVtLmljb24gPSByb290VXJsICsgbmV3SXRlbS5pY29uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdJdGVtO1xuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIFsuLi5zYW5pdGl6ZWRNZW51SXRlbXMsIC4uLnByZWRlZmluZWRNZW51SXRlbXNdO1xuICB9XG59XG4iXX0=
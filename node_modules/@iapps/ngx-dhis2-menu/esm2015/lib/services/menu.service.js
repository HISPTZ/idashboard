/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import * as fromConstants from '../constants';
import { BehaviorSubject, Observable, forkJoin } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class MenuService {
    /**
     * @param {?} httpClient
     */
    constructor(httpClient) {
        this.httpClient = httpClient;
        this._menuModules$ = new BehaviorSubject([]);
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getSystemSettings(rootUrl) {
        return Observable.create(observer => {
            forkJoin(this.httpClient.get(rootUrl + 'api/systemSettings.json'), this.httpClient.get(rootUrl + 'api/system/info.json')).subscribe((settings) => {
                observer.next(Object.assign({}, settings[0], settings[1]));
                observer.complete();
            }, () => observer.error(null));
        });
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getMenuModules(rootUrl) {
        return Observable.create(observer => {
            this.httpClient.get(rootUrl + 'dhis-web-commons/menu/getModules.action').subscribe((menuModuleResult) => {
                const /** @type {?} */ sanitizedMenu = this._sanitizeMenuItems(menuModuleResult.modules, rootUrl);
                this._menuModules$.next(sanitizedMenu);
                observer.next(sanitizedMenu);
                observer.complete();
            }, () => {
                observer.next(null);
                observer.complete();
            });
        });
    }
    /**
     * @return {?}
     */
    getSanitizedMenus() {
        return this._menuModules$.asObservable();
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getUserInfo(rootUrl) {
        return Observable.create(observer => {
            this.httpClient.get(rootUrl + 'api/me.json').subscribe((userInfo) => {
                observer.next(userInfo);
                observer.complete();
            }, () => {
                observer.next(null);
                observer.complete();
            });
        });
    }
    /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    _sanitizeMenuItems(menuItems, rootUrl) {
        const /** @type {?} */ sanitizedMenuItems = menuItems.map((item) => {
            const /** @type {?} */ newItem = Object.assign({}, item);
            if (!newItem.hasOwnProperty('displayName') ||
                newItem.displayName === '') {
                newItem.displayName = newItem.name;
            }
            if (newItem.defaultAction.indexOf('http') === -1) {
                newItem.defaultAction = '../../' + newItem.defaultAction;
            }
            if (newItem.icon.indexOf('http') === -1) {
                newItem.icon = '../../' + newItem.icon;
            }
            newItem.onlyShowOnSearch = false;
            return newItem;
        });
        const /** @type {?} */ predefinedMenuItems = fromConstants.PREDEFINED_MENU_ITEMS.map((item) => {
            const /** @type {?} */ newItem = Object.assign({}, item);
            if (newItem.defaultAction) {
                newItem.defaultAction = rootUrl + newItem.defaultAction;
            }
            if (newItem.icon) {
                newItem.icon = rootUrl + newItem.icon;
            }
            return newItem;
        });
        return [...sanitizedMenuItems, ...predefinedMenuItems];
    }
}
MenuService.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] },
];
/** @nocollapse */
MenuService.ctorParameters = () => [
    { type: HttpClient }
];
/** @nocollapse */ MenuService.ngInjectableDef = i0.defineInjectable({ factory: function MenuService_Factory() { return new MenuService(i0.inject(i1.HttpClient)); }, token: MenuService, providedIn: "root" });
function MenuService_tsickle_Closure_declarations() {
    /** @type {?} */
    MenuService.prototype._menuModules$;
    /** @type {?} */
    MenuService.prototype.httpClient;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGlhcHBzL25neC1kaGlzMi1tZW51LyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL21lbnUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxLQUFLLGFBQWEsTUFBTSxjQUFjLENBQUM7QUFDOUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7QUFHN0QsTUFBTTs7OztJQUdKLFlBQW9CLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7NkJBRk0sSUFBSSxlQUFlLENBQVEsRUFBRSxDQUFDO0tBRzdFOzs7OztJQUVELGlCQUFpQixDQUFDLE9BQWU7UUFDL0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDbEMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxFQUMvRCxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDaEUsQ0FBQyxRQUFlLEVBQUUsRUFBRTtnQkFDbEIsUUFBUSxDQUFDLElBQUksbUJBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNoRCxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDckIsRUFDRCxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUMzQixDQUFDO1NBQ0gsQ0FBQyxDQUFDO0tBQ0o7Ozs7O0lBRUQsY0FBYyxDQUFDLE9BQWU7UUFD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R0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO2FBQ3pEO1lBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7YUFDdkM7WUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDO1NBQ2hCLENBQ0YsQ0FBQztRQUNGLE1BQU0sQ0FBQyxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsR0FBRyxtQkFBbUIsQ0FBQyxDQUFDOzs7O1lBL0YxRCxVQUFVLFNBQUMsRUFBQyxVQUFVLEVBQUUsTUFBTSxFQUFDOzs7O1lBTHZCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgZnJvbUNvbnN0YW50cyBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xuXG5ASW5qZWN0YWJsZSh7cHJvdmlkZWRJbjogJ3Jvb3QnfSlcbmV4cG9ydCBjbGFzcyBNZW51U2VydmljZSB7XG4gIHByaXZhdGUgX21lbnVNb2R1bGVzJDogQmVoYXZpb3JTdWJqZWN0PGFueVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHtcbiAgfVxuXG4gIGdldFN5c3RlbVNldHRpbmdzKHJvb3RVcmw6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcbiAgICAgIGZvcmtKb2luKHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArICdhcGkvc3lzdGVtU2V0dGluZ3MuanNvbicpLFxuICAgICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnYXBpL3N5c3RlbS9pbmZvLmpzb24nKSkuc3Vic2NyaWJlKFxuICAgICAgICAoc2V0dGluZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7Li4uc2V0dGluZ3NbMF0sIC4uLnNldHRpbmdzWzFdfSk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4gb2JzZXJ2ZXIuZXJyb3IobnVsbClcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRNZW51TW9kdWxlcyhyb290VXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZShvYnNlcnZlciA9PiB7XG4gICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnZGhpcy13ZWItY29tbW9ucy9tZW51L2dldE1vZHVsZXMuYWN0aW9uJykuc3Vic2NyaWJlKFxuICAgICAgICAobWVudU1vZHVsZVJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3Qgc2FuaXRpemVkTWVudSA9IHRoaXMuX3Nhbml0aXplTWVudUl0ZW1zKG1lbnVNb2R1bGVSZXN1bHQubW9kdWxlcywgcm9vdFVybCk7XG4gICAgICAgICAgdGhpcy5fbWVudU1vZHVsZXMkLm5leHQoc2FuaXRpemVkTWVudSk7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dChcbiAgICAgICAgICAgIHNhbml0aXplZE1lbnVcbiAgICAgICAgICApO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRTYW5pdGl6ZWRNZW51cygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVudU1vZHVsZXMkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8ocm9vdFVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgJ2FwaS9tZS5qc29uJykuc3Vic2NyaWJlKFxuICAgICAgICAodXNlckluZm86IGFueSkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQodXNlckluZm8pO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9zYW5pdGl6ZU1lbnVJdGVtcyhtZW51SXRlbXM6IGFueVtdLCByb290VXJsOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IHNhbml0aXplZE1lbnVJdGVtcyA9IG1lbnVJdGVtcy5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgY29uc3QgbmV3SXRlbTogYW55ID0gey4uLml0ZW19O1xuICAgICAgaWYgKFxuICAgICAgICAhbmV3SXRlbS5oYXNPd25Qcm9wZXJ0eSgnZGlzcGxheU5hbWUnKSB8fFxuICAgICAgICBuZXdJdGVtLmRpc3BsYXlOYW1lID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIG5ld0l0ZW0uZGlzcGxheU5hbWUgPSBuZXdJdGVtLm5hbWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXdJdGVtLmRlZmF1bHRBY3Rpb24uaW5kZXhPZignaHR0cCcpID09PSAtMSkge1xuICAgICAgICBuZXdJdGVtLmRlZmF1bHRBY3Rpb24gPSAnLi4vLi4vJyArIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbjtcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld0l0ZW0uaWNvbi5pbmRleE9mKCdodHRwJykgPT09IC0xKSB7XG4gICAgICAgIG5ld0l0ZW0uaWNvbiA9ICcuLi8uLi8nICsgbmV3SXRlbS5pY29uO1xuICAgICAgfVxuXG4gICAgICBuZXdJdGVtLm9ubHlTaG93T25TZWFyY2ggPSBmYWxzZTtcblxuICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgfSk7XG5cbiAgICBjb25zdCBwcmVkZWZpbmVkTWVudUl0ZW1zID0gZnJvbUNvbnN0YW50cy5QUkVERUZJTkVEX01FTlVfSVRFTVMubWFwKFxuICAgICAgKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBuZXdJdGVtOiBhbnkgPSB7Li4uaXRlbX07XG5cbiAgICAgICAgaWYgKG5ld0l0ZW0uZGVmYXVsdEFjdGlvbikge1xuICAgICAgICAgIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbiA9IHJvb3RVcmwgKyBuZXdJdGVtLmRlZmF1bHRBY3Rpb247XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3SXRlbS5pY29uKSB7XG4gICAgICAgICAgbmV3SXRlbS5pY29uID0gcm9vdFVybCArIG5ld0l0ZW0uaWNvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3SXRlbTtcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBbLi4uc2FuaXRpemVkTWVudUl0ZW1zLCAuLi5wcmVkZWZpbmVkTWVudUl0ZW1zXTtcbiAgfVxufVxuIl19